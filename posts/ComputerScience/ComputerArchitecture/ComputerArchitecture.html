<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://riicarus.github.io/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html"><meta property="og:site_name" content="Riicarus"><meta property="og:title" content="计算机体系结构"><meta property="og:description" content="计算机体系结构 概述 分类 Flynn 分类 市场分类 系统结构的定义 性能评价 量化方法 指令系统 指令集系统结构分类及特点 通用寄存器系统结构的分类及特点 存储器寻址 寻址方式 MIPS 寻址模式总结 操作数 指令系统的操作 控制流指令 指令系统的编码 MIPS 系统结构指令和寻址特点 流水线技术 基本概念 流水线时空图及性能分析 时空图 各段时间相等的时空图 各段时间不同的流水线 性能分析 加速比 效率 RISC 指令系统特点 非流水线下 RISC 指令系统的实现 单周期 多周期 多周期性能改进 经典 5 段流水线 RISC 处理器 流水线寄存器 流水线冒险 冒险分类与有停顿流水线性能 结构冒险: 流水段竞争 数据冒险 控制冒险 增加内容流水线处理机及其设计 流水线处理机的指令系统和格式 流水线转移指令控制 流水线数据冒险解决 内部前推 Load 前推 流水线异常 异常在 MIPS 程序中的处理 精确异常 非精确异常 存储层次结构 Cache 映像规则 块识别 块替换 写策略 Cache 性能 存储器系统性能 Cache 性能改善方法 减少 Cache 缺失率 减少 Cache 缺失代价 通过并行减少 减少 Cache 命中时间 主存储器性能优化 增加带宽 交叉访问存储器 虚拟存储器 页式虚拟存储器"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-06-05T18:24:55.000Z"><meta property="article:tag" content="计算机组成结构"><meta property="article:published_time" content="2023-03-14T00:00:00.000Z"><meta property="article:modified_time" content="2023-06-05T18:24:55.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"计算机体系结构","image":[""],"datePublished":"2023-03-14T00:00:00.000Z","dateModified":"2023-06-05T18:24:55.000Z","author":[]}</script><link rel="icon" href="/logo.png"><title>计算机体系结构 | Riicarus</title><meta name="description" content="计算机体系结构 概述 分类 Flynn 分类 市场分类 系统结构的定义 性能评价 量化方法 指令系统 指令集系统结构分类及特点 通用寄存器系统结构的分类及特点 存储器寻址 寻址方式 MIPS 寻址模式总结 操作数 指令系统的操作 控制流指令 指令系统的编码 MIPS 系统结构指令和寻址特点 流水线技术 基本概念 流水线时空图及性能分析 时空图 各段时间相等的时空图 各段时间不同的流水线 性能分析 加速比 效率 RISC 指令系统特点 非流水线下 RISC 指令系统的实现 单周期 多周期 多周期性能改进 经典 5 段流水线 RISC 处理器 流水线寄存器 流水线冒险 冒险分类与有停顿流水线性能 结构冒险: 流水段竞争 数据冒险 控制冒险 增加内容流水线处理机及其设计 流水线处理机的指令系统和格式 流水线转移指令控制 流水线数据冒险解决 内部前推 Load 前推 流水线异常 异常在 MIPS 程序中的处理 精确异常 非精确异常 存储层次结构 Cache 映像规则 块识别 块替换 写策略 Cache 性能 存储器系统性能 Cache 性能改善方法 减少 Cache 缺失率 减少 Cache 缺失代价 通过并行减少 减少 Cache 命中时间 主存储器性能优化 增加带宽 交叉访问存储器 虚拟存储器 页式虚拟存储器">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-256a168b.css" as="style"><link rel="stylesheet" href="/assets/style-256a168b.css">
    <link rel="modulepreload" href="/assets/app-1db72e39.js"><link rel="modulepreload" href="/assets/framework-c6791857.js"><link rel="modulepreload" href="/assets/ComputerArchitecture.html-2c32e1d7.js"><link rel="modulepreload" href="/assets/ComputerArchitecture.html-346afd78.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.png" alt="Riicarus"><!----><span class="site-name hide-in-pad">Riicarus</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="Riicarus&#39; Blog"><span class="font-icon icon iconfont icon-home" style=""></span>Riicarus&#39; Blog<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>JDK</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Java/JDK/java.lang.html" class="nav-link" aria-label="Java lang 包"><span class="font-icon icon iconfont icon-file" style=""></span>Java lang 包<!----></a></li><li class="dropdown-subitem"><a href="/posts/Java/JDK/java.util.html" class="nav-link" aria-label="Java util 包"><span class="font-icon icon iconfont icon-file" style=""></span>Java util 包<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>JUC</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Java/JUC/ThreadPool.html" class="nav-link" aria-label="线程池"><span class="font-icon icon iconfont icon-file" style=""></span>线程池<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>JVM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Java/JVM/JavaMemoryArea.html" class="nav-link" aria-label="Java 内存区域"><span class="font-icon icon iconfont icon-file" style=""></span>Java 内存区域<!----></a></li><li class="dropdown-subitem"><a href="/posts/Java/JVM/JavaGC.html" class="nav-link" aria-label="Java GC"><span class="font-icon icon iconfont icon-file" style=""></span>Java GC<!----></a></li><li class="dropdown-subitem"><a href="/posts/Java/JVM/ClassLoad.html" class="nav-link" aria-label="类加载机制"><span class="font-icon icon iconfont icon-file" style=""></span>类加载机制<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>代码规范</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Java/CodeSpecification/EffectiveJava.html" class="nav-link" aria-label="EffectiveJava"><span class="font-icon icon iconfont icon-file" style=""></span>EffectiveJava<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="算法"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>算法</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>模板</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Algorithm/Template/DataStructure/" class="nav-link" aria-label="数据结构"><span class="font-icon icon iconfont icon-folder" style=""></span>数据结构<!----></a></li><li class="dropdown-subitem"><a href="/posts/Algorithm/Template/Search/" class="nav-link" aria-label="搜索"><span class="font-icon icon iconfont icon-folder" style=""></span>搜索<!----></a></li><li class="dropdown-subitem"><a href="/posts/Algorithm/Template/DynamicProgramming/" class="nav-link" aria-label="动态规划"><span class="font-icon icon iconfont icon-folder" style=""></span>动态规划<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>置换算法</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Algorithm/Replacement/LRU.html" class="nav-link" aria-label="LRU"><span class="font-icon icon iconfont icon-file" style=""></span>LRU<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>读谱不能</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Algorithm/SuchDifficult/PackFruit.html" class="nav-link" aria-label="水果打包"><span class="font-icon icon iconfont icon-file" style=""></span>水果打包<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="架构设计"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>架构设计</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>高并发设计</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Architecture/HighConcurrency/SpikeSystemDesign.html" class="nav-link" aria-label="秒杀系统设计"><span class="font-icon icon iconfont icon-file" style=""></span>秒杀系统设计<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>分布式</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Architecture/DistributedSystem/DistributedSystem(MIT%206.824).html" class="nav-link" aria-label="分布式系统"><span class="font-icon icon iconfont icon-file" style=""></span>分布式系统<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="中间件"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>缓存</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Middleware/Cache/Cache.html" class="nav-link" aria-label="缓存"><span class="font-icon icon iconfont icon-file" style=""></span>缓存<!----></a></li><li class="dropdown-subitem"><a href="/posts/Middleware/Cache/BloomFilter.html" class="nav-link" aria-label="布隆过滤器"><span class="font-icon icon iconfont icon-file" style=""></span>布隆过滤器<!----></a></li><li class="dropdown-subitem"><a href="/posts/Middleware/Cache/Lua.html" class="nav-link" aria-label="LUA"><span class="font-icon icon iconfont icon-file" style=""></span>LUA<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>消息队列</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Middleware/MQ/MQ.html" class="nav-link" aria-label="消息队列"><span class="font-icon icon iconfont icon-file" style=""></span>消息队列<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="组件"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>组件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/posts/Component/TimeWheel.html" class="nav-link" aria-label="时间轮"><span class="font-icon icon iconfont icon-file" style=""></span>时间轮<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="计算机科学"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>计算机科学</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>编译原理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/ComputerScience/CompilationPrinciple/CompilationPrinciple.html" class="nav-link" aria-label="编译原理基础"><span class="font-icon icon iconfont icon-file" style=""></span>编译原理基础<!----></a></li><li class="dropdown-subitem"><a href="/posts/ComputerScience/CompilationPrinciple/CompilationPrincipleExp.html" class="nav-link" aria-label="编译原理实验"><span class="font-icon icon iconfont icon-file" style=""></span>编译原理实验<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>计算机体系结构</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html" class="router-link-active router-link-exact-active nav-link active" aria-label="计算机体系结构"><span class="font-icon icon iconfont icon-file" style=""></span>计算机体系结构<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>计算机网络</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/ComputerScience/ComputerNetworking/Generic.html" class="nav-link" aria-label="概述"><span class="font-icon icon iconfont icon-file" style=""></span>概述<!----></a></li><li class="dropdown-subitem"><a href="/posts/ComputerScience/ComputerNetworking/HTTP(S).html" class="nav-link" aria-label="HTTP(S)"><span class="font-icon icon iconfont icon-file" style=""></span>HTTP(S)<!----></a></li><li class="dropdown-subitem"><a href="/posts/ComputerScience/ComputerNetworking/WebSocket.html" class="nav-link" aria-label="WebSocket"><span class="font-icon icon iconfont icon-file" style=""></span>WebSocket<!----></a></li><li class="dropdown-subitem"><a href="/posts/ComputerScience/ComputerNetworking/TCP.html" class="nav-link" aria-label="TCP"><span class="font-icon icon iconfont icon-file" style=""></span>TCP<!----></a></li><li class="dropdown-subitem"><a href="/posts/ComputerScience/ComputerNetworking/UDP.html" class="nav-link" aria-label="UDP"><span class="font-icon icon iconfont icon-file" style=""></span>UDP<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/ComputerScience/Database/MySQL_Index.html" class="nav-link" aria-label="索引"><span class="font-icon icon iconfont icon-file" style=""></span>索引<!----></a></li><li class="dropdown-subitem"><a href="/posts/ComputerScience/Database/Transaction.html" class="nav-link" aria-label="事务"><span class="font-icon icon iconfont icon-file" style=""></span>事务<!----></a></li><li class="dropdown-subitem"><a href="/posts/ComputerScience/Database/SQL.html" class="nav-link" aria-label="SQL"><span class="font-icon icon iconfont icon-file" style=""></span>SQL<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="星辰"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>星辰</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/posts/StarStudio/LearningPath.html" class="nav-link" aria-label="学习路线"><span class="font-icon icon iconfont icon-file" style=""></span>学习路线<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/posts/InterviewLog/" class="nav-link" aria-label="面经"><span class="font-icon icon iconfont icon-folder" style=""></span>面经<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目"><span class="title"><span class="font-icon icon iconfont icon-folder" style=""></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>编译器</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/Project/Compiler/LangDefine.html" class="nav-link" aria-label="语言定义"><span class="font-icon icon iconfont icon-file" style=""></span>语言定义<!----></a></li></ul></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Riicarus" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="Riicarus&#39; Blog"><span class="font-icon icon iconfont icon-home" style=""></span>Riicarus&#39; Blog<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">文章</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">Java</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">算法</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">架构设计</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">中间件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">组件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">计算机科学</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">编译原理</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">计算机体系结构</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="计算机体系结构"><!---->计算机体系结构<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="概述"><!---->概述<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#分类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="分类"><!---->分类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#系统结构的定义" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="系统结构的定义"><!---->系统结构的定义<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#性能评价" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="性能评价"><!---->性能评价<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#量化方法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="量化方法"><!---->量化方法<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令系统" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="指令系统"><!---->指令系统<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令集系统结构分类及特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="指令集系统结构分类及特点"><!---->指令集系统结构分类及特点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#通用寄存器系统结构的分类及特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="通用寄存器系统结构的分类及特点"><!---->通用寄存器系统结构的分类及特点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#存储器寻址" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="存储器寻址"><!---->存储器寻址<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#操作数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="操作数"><!---->操作数<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令系统的操作" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="指令系统的操作"><!---->指令系统的操作<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#控制流指令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="控制流指令"><!---->控制流指令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令系统的编码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="指令系统的编码"><!---->指令系统的编码<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#mips-系统结构指令和寻址特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MIPS 系统结构指令和寻址特点"><!---->MIPS 系统结构指令和寻址特点<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线技术" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="流水线技术"><!---->流水线技术<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#基本概念" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="基本概念"><!---->基本概念<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线时空图及性能分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="流水线时空图及性能分析"><!---->流水线时空图及性能分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#risc-指令系统特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="RISC 指令系统特点"><!---->RISC 指令系统特点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#非流水线下-risc-指令系统的实现" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="非流水线下 RISC 指令系统的实现"><!---->非流水线下 RISC 指令系统的实现<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#经典-5-段流水线-risc-处理器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="经典 5 段流水线 RISC 处理器"><!---->经典 5 段流水线 RISC 处理器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线冒险" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="流水线冒险"><!---->流水线冒险<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#增加内容流水线处理机及其设计" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="增加内容流水线处理机及其设计"><!---->增加内容流水线处理机及其设计<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线处理机的指令系统和格式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="流水线处理机的指令系统和格式"><!---->流水线处理机的指令系统和格式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线转移指令控制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="流水线转移指令控制"><!---->流水线转移指令控制<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线数据冒险解决" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="流水线数据冒险解决"><!---->流水线数据冒险解决<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线异常" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="流水线异常"><!---->流水线异常<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#异常在-mips-程序中的处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="异常在 MIPS 程序中的处理"><!---->异常在 MIPS 程序中的处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#精确异常" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="精确异常"><!---->精确异常<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#非精确异常" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="非精确异常"><!---->非精确异常<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#存储层次结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="存储层次结构"><!---->存储层次结构<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#cache" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Cache"><!---->Cache<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#cache-性能" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Cache 性能"><!---->Cache 性能<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#cache-性能改善方法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Cache 性能改善方法"><!---->Cache 性能改善方法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#主存储器性能优化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="主存储器性能优化"><!---->主存储器性能优化<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#虚拟存储器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="虚拟存储器"><!---->虚拟存储器<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">计算机网络</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">数据库</span><span class="arrow right"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">星辰</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">项目</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-folder" style=""></span><span class="title">面经</span><span class="arrow right"></span></button><!----></section></li></ul></section></li><li><!--[--><a href="/intro.html" class="nav-link sidebar-link sidebar-page" aria-label="关于"><span class="font-icon icon iconfont icon-info" style=""></span>关于<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->计算机体系结构</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/Riicarus" target="_blank" rel="noopener noreferrer">Riicarus</a></span><span property="author" content="Riicarus"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-03-14T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 48 分钟</span><meta property="timeRequired" content="PT48M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category6 clickable" role="navigation">计算机科学</span><span class="page-category-item category2 clickable" role="navigation">计算机组成结构</span><meta property="articleSection" content="计算机科学,计算机组成结构"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag2 clickable" role="navigation">计算机组成结构</span><meta property="keywords" content="计算机组成结构"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#概述" class="router-link-active router-link-exact-active toc-link level2">概述</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#分类" class="router-link-active router-link-exact-active toc-link level3">分类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#系统结构的定义" class="router-link-active router-link-exact-active toc-link level3">系统结构的定义</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#性能评价" class="router-link-active router-link-exact-active toc-link level3">性能评价</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#量化方法" class="router-link-active router-link-exact-active toc-link level3">量化方法</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令系统" class="router-link-active router-link-exact-active toc-link level2">指令系统</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令集系统结构分类及特点" class="router-link-active router-link-exact-active toc-link level3">指令集系统结构分类及特点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#通用寄存器系统结构的分类及特点" class="router-link-active router-link-exact-active toc-link level3">通用寄存器系统结构的分类及特点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#存储器寻址" class="router-link-active router-link-exact-active toc-link level3">存储器寻址</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#操作数" class="router-link-active router-link-exact-active toc-link level3">操作数</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令系统的操作" class="router-link-active router-link-exact-active toc-link level3">指令系统的操作</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#控制流指令" class="router-link-active router-link-exact-active toc-link level3">控制流指令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#指令系统的编码" class="router-link-active router-link-exact-active toc-link level3">指令系统的编码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#mips-系统结构指令和寻址特点" class="router-link-active router-link-exact-active toc-link level3">MIPS 系统结构指令和寻址特点</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线技术" class="router-link-active router-link-exact-active toc-link level2">流水线技术</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#基本概念" class="router-link-active router-link-exact-active toc-link level3">基本概念</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线时空图及性能分析" class="router-link-active router-link-exact-active toc-link level3">流水线时空图及性能分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#risc-指令系统特点" class="router-link-active router-link-exact-active toc-link level3">RISC 指令系统特点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#非流水线下-risc-指令系统的实现" class="router-link-active router-link-exact-active toc-link level3">非流水线下 RISC 指令系统的实现</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#经典-5-段流水线-risc-处理器" class="router-link-active router-link-exact-active toc-link level3">经典 5 段流水线 RISC 处理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线冒险" class="router-link-active router-link-exact-active toc-link level3">流水线冒险</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#增加内容流水线处理机及其设计" class="router-link-active router-link-exact-active toc-link level2">增加内容流水线处理机及其设计</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线处理机的指令系统和格式" class="router-link-active router-link-exact-active toc-link level3">流水线处理机的指令系统和格式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线转移指令控制" class="router-link-active router-link-exact-active toc-link level3">流水线转移指令控制</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线数据冒险解决" class="router-link-active router-link-exact-active toc-link level3">流水线数据冒险解决</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#流水线异常" class="router-link-active router-link-exact-active toc-link level2">流水线异常</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#异常在-mips-程序中的处理" class="router-link-active router-link-exact-active toc-link level3">异常在 MIPS 程序中的处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#精确异常" class="router-link-active router-link-exact-active toc-link level3">精确异常</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#非精确异常" class="router-link-active router-link-exact-active toc-link level3">非精确异常</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#存储层次结构" class="router-link-active router-link-exact-active toc-link level2">存储层次结构</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#cache" class="router-link-active router-link-exact-active toc-link level3">Cache</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#cache-性能" class="router-link-active router-link-exact-active toc-link level3">Cache 性能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#cache-性能改善方法" class="router-link-active router-link-exact-active toc-link level3">Cache 性能改善方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#主存储器性能优化" class="router-link-active router-link-exact-active toc-link level3">主存储器性能优化</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.html#虚拟存储器" class="router-link-active router-link-exact-active toc-link level3">虚拟存储器</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="计算机体系结构" tabindex="-1"><a class="header-anchor" href="#计算机体系结构" aria-hidden="true">#</a> 计算机体系结构</h1><ul><li><a href="#%E6%A6%82%E8%BF%B0">概述</a><ul><li><a href="#%E5%88%86%E7%B1%BB">分类</a><ul><li><a href="#flynn-%E5%88%86%E7%B1%BB">Flynn 分类</a></li><li><a href="#%E5%B8%82%E5%9C%BA%E5%88%86%E7%B1%BB">市场分类</a></li></ul></li><li><a href="#%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E7%9A%84%E5%AE%9A%E4%B9%89">系统结构的定义</a></li><li><a href="#%E6%80%A7%E8%83%BD%E8%AF%84%E4%BB%B7">性能评价</a></li><li><a href="#%E9%87%8F%E5%8C%96%E6%96%B9%E6%B3%95">量化方法</a></li></ul></li><li><a href="#%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F">指令系统</a><ul><li><a href="#%E6%8C%87%E4%BB%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E5%88%86%E7%B1%BB%E5%8F%8A%E7%89%B9%E7%82%B9">指令集系统结构分类及特点</a></li><li><a href="#%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E7%9A%84%E5%88%86%E7%B1%BB%E5%8F%8A%E7%89%B9%E7%82%B9">通用寄存器系统结构的分类及特点</a></li><li><a href="#%E5%AD%98%E5%82%A8%E5%99%A8%E5%AF%BB%E5%9D%80">存储器寻址</a><ul><li><a href="#%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F">寻址方式</a></li><li><a href="#mips-%E5%AF%BB%E5%9D%80%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93">MIPS 寻址模式总结</a></li></ul></li><li><a href="#%E6%93%8D%E4%BD%9C%E6%95%B0">操作数</a></li><li><a href="#%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%93%8D%E4%BD%9C">指令系统的操作</a></li><li><a href="#%E6%8E%A7%E5%88%B6%E6%B5%81%E6%8C%87%E4%BB%A4">控制流指令</a></li><li><a href="#%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BC%96%E7%A0%81">指令系统的编码</a></li><li><a href="#mips-%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E6%8C%87%E4%BB%A4%E5%92%8C%E5%AF%BB%E5%9D%80%E7%89%B9%E7%82%B9">MIPS 系统结构指令和寻址特点</a></li></ul></li><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8A%80%E6%9C%AF">流水线技术</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">基本概念</a></li><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%97%B6%E7%A9%BA%E5%9B%BE%E5%8F%8A%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90">流水线时空图及性能分析</a><ul><li><a href="#%E6%97%B6%E7%A9%BA%E5%9B%BE">时空图</a><ul><li><a href="#%E5%90%84%E6%AE%B5%E6%97%B6%E9%97%B4%E7%9B%B8%E7%AD%89%E7%9A%84%E6%97%B6%E7%A9%BA%E5%9B%BE">各段时间相等的时空图</a></li><li><a href="#%E5%90%84%E6%AE%B5%E6%97%B6%E9%97%B4%E4%B8%8D%E5%90%8C%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF">各段时间不同的流水线</a></li></ul></li><li><a href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90">性能分析</a><ul><li><a href="#%E5%8A%A0%E9%80%9F%E6%AF%94">加速比</a></li><li><a href="#%E6%95%88%E7%8E%87">效率</a></li></ul></li></ul></li><li><a href="#risc-%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%89%B9%E7%82%B9">RISC 指令系统特点</a></li><li><a href="#%E9%9D%9E%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%8B-risc-%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0">非流水线下 RISC 指令系统的实现</a><ul><li><a href="#%E5%8D%95%E5%91%A8%E6%9C%9F">单周期</a></li><li><a href="#%E5%A4%9A%E5%91%A8%E6%9C%9F">多周期</a></li><li><a href="#%E5%A4%9A%E5%91%A8%E6%9C%9F%E6%80%A7%E8%83%BD%E6%94%B9%E8%BF%9B">多周期性能改进</a></li></ul></li><li><a href="#%E7%BB%8F%E5%85%B8-5-%E6%AE%B5%E6%B5%81%E6%B0%B4%E7%BA%BF-risc-%E5%A4%84%E7%90%86%E5%99%A8">经典 5 段流水线 RISC 处理器</a><ul><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AF%84%E5%AD%98%E5%99%A8">流水线寄存器</a></li></ul></li><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%86%92%E9%99%A9">流水线冒险</a><ul><li><a href="#%E5%86%92%E9%99%A9%E5%88%86%E7%B1%BB%E4%B8%8E%E6%9C%89%E5%81%9C%E9%A1%BF%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%80%A7%E8%83%BD">冒险分类与有停顿流水线性能</a></li><li><a href="#%E7%BB%93%E6%9E%84%E5%86%92%E9%99%A9-%E6%B5%81%E6%B0%B4%E6%AE%B5%E7%AB%9E%E4%BA%89">结构冒险: 流水段竞争</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%86%92%E9%99%A9">数据冒险</a></li><li><a href="#%E6%8E%A7%E5%88%B6%E5%86%92%E9%99%A9">控制冒险</a></li></ul></li></ul></li><li><a href="#%E5%A2%9E%E5%8A%A0%E5%86%85%E5%AE%B9%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%A4%84%E7%90%86%E6%9C%BA%E5%8F%8A%E5%85%B6%E8%AE%BE%E8%AE%A1">增加内容流水线处理机及其设计</a><ul><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%A4%84%E7%90%86%E6%9C%BA%E7%9A%84%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E5%92%8C%E6%A0%BC%E5%BC%8F">流水线处理机的指令系统和格式</a></li><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%BD%AC%E7%A7%BB%E6%8C%87%E4%BB%A4%E6%8E%A7%E5%88%B6">流水线转移指令控制</a></li><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%95%B0%E6%8D%AE%E5%86%92%E9%99%A9%E8%A7%A3%E5%86%B3">流水线数据冒险解决</a><ul><li><a href="#%E5%86%85%E9%83%A8%E5%89%8D%E6%8E%A8">内部前推</a></li><li><a href="#load-%E5%89%8D%E6%8E%A8">Load 前推</a></li></ul></li></ul></li><li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%BC%82%E5%B8%B8">流水线异常</a><ul><li><a href="#%E5%BC%82%E5%B8%B8%E5%9C%A8-mips-%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86">异常在 MIPS 程序中的处理</a></li><li><a href="#%E7%B2%BE%E7%A1%AE%E5%BC%82%E5%B8%B8">精确异常</a></li><li><a href="#%E9%9D%9E%E7%B2%BE%E7%A1%AE%E5%BC%82%E5%B8%B8">非精确异常</a></li></ul></li><li><a href="#%E5%AD%98%E5%82%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84">存储层次结构</a><ul><li><a href="#cache">Cache</a><ul><li><a href="#%E6%98%A0%E5%83%8F%E8%A7%84%E5%88%99">映像规则</a></li><li><a href="#%E5%9D%97%E8%AF%86%E5%88%AB">块识别</a></li><li><a href="#%E5%9D%97%E6%9B%BF%E6%8D%A2">块替换</a></li><li><a href="#%E5%86%99%E7%AD%96%E7%95%A5">写策略</a></li></ul></li><li><a href="#cache-%E6%80%A7%E8%83%BD">Cache 性能</a><ul><li><a href="#%E5%AD%98%E5%82%A8%E5%99%A8%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD">存储器系统性能</a></li></ul></li><li><a href="#cache-%E6%80%A7%E8%83%BD%E6%94%B9%E5%96%84%E6%96%B9%E6%B3%95">Cache 性能改善方法</a><ul><li><a href="#%E5%87%8F%E5%B0%91-cache-%E7%BC%BA%E5%A4%B1%E7%8E%87">减少 Cache 缺失率</a></li><li><a href="#%E5%87%8F%E5%B0%91-cache-%E7%BC%BA%E5%A4%B1%E4%BB%A3%E4%BB%B7">减少 Cache 缺失代价</a></li><li><a href="#%E9%80%9A%E8%BF%87%E5%B9%B6%E8%A1%8C%E5%87%8F%E5%B0%91">通过并行减少</a></li><li><a href="#%E5%87%8F%E5%B0%91-cache-%E5%91%BD%E4%B8%AD%E6%97%B6%E9%97%B4">减少 Cache 命中时间</a></li></ul></li><li><a href="#%E4%B8%BB%E5%AD%98%E5%82%A8%E5%99%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">主存储器性能优化</a><ul><li><a href="#%E5%A2%9E%E5%8A%A0%E5%B8%A6%E5%AE%BD">增加带宽</a></li><li><a href="#%E4%BA%A4%E5%8F%89%E8%AE%BF%E9%97%AE%E5%AD%98%E5%82%A8%E5%99%A8">交叉访问存储器</a></li></ul></li><li><a href="#%E8%99%9A%E6%8B%9F%E5%AD%98%E5%82%A8%E5%99%A8">虚拟存储器</a><ul><li><a href="#%E9%A1%B5%E5%BC%8F%E8%99%9A%E6%8B%9F%E5%AD%98%E5%82%A8%E5%99%A8">页式虚拟存储器</a></li></ul></li></ul></li></ul><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><h3 id="分类" tabindex="-1"><a class="header-anchor" href="#分类" aria-hidden="true">#</a> 分类</h3><h4 id="flynn-分类" tabindex="-1"><a class="header-anchor" href="#flynn-分类" aria-hidden="true">#</a> Flynn 分类</h4><p>基于<strong>指令流和数据流数量</strong>的计算机结构分类.</p><ul><li>SISD</li><li>MISD</li><li>SIMD</li><li>MIMD</li></ul><p><strong>SISD</strong>: 串行计算机, 在任何时钟周期, 只有单个指令流在 CPU 执行, 只有单个数据流用作输入. 执行结果是确定的(程序在给定输入条件下多次运行, 执行流程和结果是一致的).</p><p><strong>SIMD</strong>: 并行计算机, 在任一时钟周期, 所有处理单元执行相同的指令, 但是每个处理单元能对不同数据元素进行操作.</p><p>主要用于处理高度规整操作的问题, 如: 图像处理. 执行具有同步性和确定性.</p><p><strong>MISD</strong>: 单个数据流进入多个处理单元, 每个处理单元用多个指令流对单个数据进行<strong>独立</strong>操作.</p><p><em>很少有此类必须计算机的实例</em>.</p><p><strong>MIMD</strong>: 并行计算机: 线程级或任务级并行. 每个处理器可以执行不同的指令流, 可以对不同的数据流进行操作. 各处理器执行可以是同步的或者异步的, 确定性的或者非确定性的.</p><p>比 SIMD 更灵活, 适应性更强. 何时何任务级并行, 也可以开发数据级并行, 开销比 SIMD 高.</p><h4 id="市场分类" tabindex="-1"><a class="header-anchor" href="#市场分类" aria-hidden="true">#</a> 市场分类</h4><ul><li>个人/移动设备: 成本/功耗/媒体性能/响应率</li><li>桌面计算机: 性价比/图形性能/能耗</li><li>服务器: 可靠性/吞吐量/可扩展性, 都是<strong>多处理器结构</strong></li><li>集群/仓库级计算机: 性价比/吞吐量/能耗/均衡性</li><li>嵌入式计算机: 价格/功耗/专门应用的性能</li></ul><h3 id="系统结构的定义" tabindex="-1"><a class="header-anchor" href="#系统结构的定义" aria-hidden="true">#</a> 系统结构的定义</h3><p>计算机系统结构的<strong>原始</strong>概念是: 由程序员(机器语言)看见的(计算)系统属性, 即概念性结构和功能行为, 以区分数据流动和控制逻辑设计的组成和物理实现.</p><p>计算机系统结构的<strong>现代</strong>定义是: 在满足功能/性能和价格目标的条件下, 设计/选则和互联硬件部件构成计算机. 系统结构覆盖:</p><ul><li>指令系统设计</li><li>组成: 计算机设计方面的高层次, 如: cpu 内部结构, 存储器, I/O 系统等</li><li>硬件: 计算机的具体实现技术</li></ul><p><strong>区分</strong>:</p><ul><li>计算机系统结构: 机器语言/程序员看到的传统机器级所具有的<strong>属性</strong>.</li><li>计算机组成: 计算机系统结构的逻辑实现, 包括五大功能部件<strong>组成以及逻辑设计</strong>等. 着眼于机器级内各<strong>事件的排序方式和控制方式</strong>, 各部件的功能以及各部件的联系.</li><li>计算机实现: 计算机组成的物理实现, 包括各部件的物理结构, 器件的<strong>集成度和速度功耗</strong>等.</li><li>具有相同计算机系统结构(指令系统相同)的计算机, 因为速度要求不同等因素, 可以采用不同的计算机组成; 一种计算机组成也可以采用不同的计算机实现.</li></ul><p>ISA 的 7 个重要特征:</p><ul><li>ISA 类型</li><li>存储器访问</li><li>寻址方式</li><li>操作数类型和大小</li><li>操作类型</li><li>控制流指令</li><li>ISA 编码</li></ul><h3 id="性能评价" tabindex="-1"><a class="header-anchor" href="#性能评价" aria-hidden="true">#</a> 性能评价</h3><p>比较机器性能的指标:</p><ul><li>执行时间(响应时间/时延): 桌面机, 反应系统性能, 仅有的<strong>各方面都认可的性能测量指标</strong></li><li>CPU 时间: 设计者考虑, 反应 CPU 性能</li><li>吞吐量: 网站服务器</li><li>MIPS: millions of instructions per second</li></ul><p>用程序集比较机器性能:</p><ul><li>选择适当的程序评估性能: 基准测试程序套件</li><li>不同平均值</li></ul><h3 id="量化方法" tabindex="-1"><a class="header-anchor" href="#量化方法" aria-hidden="true">#</a> 量化方法</h3><p>SPEC Ratio:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mi>P</mi><mi>E</mi><mi>C</mi><mi>R</mi><mi>a</mi><mi>t</mi><mi>i</mi><msub><mi>o</mi><mi>A</mi></msub><mo>=</mo><mfrac><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>A</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> SPECRatio_A = \frac{ExecutionTimeOfReferenceComputer}{ExecutionTimeOfComputerA} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">SPECR</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">A</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">ere</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>SM(Spec Mark): 被测试计算机执行 n 个基准测试程序分别得到的 SPECRatio 的集合平均值, 是<strong>一个综合指标以衡量不同计算机的性能</strong>.</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mi>M</mi><mo>=</mo><mroot><mrow><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>S</mi><mi>P</mi><mi>E</mi><mi>C</mi><mi>R</mi><mi>a</mi><mi>t</mi><mi>i</mi><msub><mi>o</mi><mi>i</mi></msub></mrow><mi>n</mi></mroot></mrow><annotation encoding="application/x-tex"> SM = \sqrt[n]{\prod_{i=1}^{n}SPECRatio_i} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">SM</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1568em;vertical-align:-1.2777em;"></span><span class="mord sqrt"><span class="root"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5762em;"><span style="top:-2.8609em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size6 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8791em;"><span class="svg-align" style="top:-5.1168em;"><span class="pstrut" style="height:5.1168em;"></span><span class="mord" style="padding-left:1.056em;"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">SPECR</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8391em;"><span class="pstrut" style="height:5.1168em;"></span><span class="hide-tail" style="min-width:0.742em;height:3.1968em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="3.1968em" viewBox="0 0 400000 3196" preserveAspectRatio="xMinYMin slice"><path d="M702 80H40000040
H742v3062l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 80H400000v40H742z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span></span></span></span></span></p><p>量化原则:</p><ul><li>利用并行性: 系统级/指令级/操作级并行</li><li>局部性原理: <ul><li>时间局部性</li><li>空间局部性</li></ul></li><li>注重常用事件: 量化该原则的基本定律--Amdahl&#39;s law</li></ul><p>Amdahl 定律:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mi>p</mi><mi>e</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>R</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mo>=</mo><mfrac><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>N</mi><mi>o</mi><mi>t</mi><mi>O</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>O</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> SpeedUpRatio = \frac{ExecutionTimeOfNotOptimizedComputer}{ExecutionTimeOfOptimizedComputer} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Sp</span><span class="mord mathnormal">ee</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.00773em;">pR</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">Opt</span><span class="mord mathnormal">imi</span><span class="mord mathnormal">ze</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">tOpt</span><span class="mord mathnormal">imi</span><span class="mord mathnormal">ze</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>改进比例:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>F</mi><mi>e</mi></msub><mo>=</mo><mfrac><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>C</mi><mi>a</mi><mi>n</mi><mi>B</mi><mi>e</mi><mi>O</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi><mi>I</mi><mi>m</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>v</mi><mi>e</mi><mi>d</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>W</mi><mi>h</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>N</mi><mi>o</mi><mi>t</mi><mi>O</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> F_e = \frac{ExecutionTimeOfCanBeOptimizedImprovedPart}{ExecutionTimeOfWholeNotOptimizedWork} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">Wh</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">tOpt</span><span class="mord mathnormal">imi</span><span class="mord mathnormal">ze</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">an</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">e</span><span class="mord mathnormal">Opt</span><span class="mord mathnormal">imi</span><span class="mord mathnormal">ze</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>改进加速比:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mi>e</mi></msub><mo>=</mo><mfrac><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>N</mi><mi>o</mi><mi>t</mi><mi>O</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow><mrow><mi>E</mi><mi>x</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>O</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> S_e = \frac{ExecutionTimeOfNotOptimizedPart}{ExecutionTimeOfOptimizedPart} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">Opt</span><span class="mord mathnormal">imi</span><span class="mord mathnormal">ze</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">tOpt</span><span class="mord mathnormal">imi</span><span class="mord mathnormal">ze</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>改进后整个系统的加速比:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mi>n</mi></msub><mo>=</mo><mfrac><msub><mi>T</mi><mn>0</mn></msub><msub><mi>T</mi><mi>n</mi></msub></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>F</mi><mi>e</mi></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>F</mi><mi>e</mi></msub><mi mathvariant="normal">/</mi><msub><mi>S</mi><mi>e</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> S_n = \frac{T_0}{T_n} = \frac{1}{(1-F_e) + F_e/S_e} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2574em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>可见, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">F_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">S_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 影响更大.</p><h2 id="指令系统" tabindex="-1"><a class="header-anchor" href="#指令系统" aria-hidden="true">#</a> 指令系统</h2><h3 id="指令集系统结构分类及特点" tabindex="-1"><a class="header-anchor" href="#指令集系统结构分类及特点" aria-hidden="true">#</a> 指令集系统结构分类及特点</h3><p>指令集系统结构(Instruction Set Architecture, ISA), 即计算机硬件对程序员和编译器开发者可见的部分.</p><p>ISA 的分类方面, 不同指令集系统结构最根本的区别在于: <strong>处理器内部数据的存储结构不同</strong>.</p><p>存储结构包括: 堆栈/累加器/一组寄存器. 操作数可以显式执行或者隐含指定.</p><ul><li><strong>堆栈系统结构</strong>中操作数<strong>隐含</strong>的位于栈顶.</li><li><strong>累加器系统结构</strong>中的一个<strong>隐含</strong>操作数就是累加器.</li><li><strong>通用寄存器结构</strong>中只能<strong>明确指定</strong>操作数, 不是<strong>寄存器</strong>就是<strong>存储器地址</strong>.</li></ul><figure><img src="/assets/GPRs-6ebf8f6b.png" alt="GPRs" tabindex="0" loading="lazy"><figcaption>GPRs</figcaption></figure><h3 id="通用寄存器系统结构的分类及特点" tabindex="-1"><a class="header-anchor" href="#通用寄存器系统结构的分类及特点" aria-hidden="true">#</a> 通用寄存器系统结构的分类及特点</h3><p>按照通用寄存器(GPR)访问方式划分:</p><ul><li>register-memory 系统结构: 一般指令都可以访问存储器.</li><li>register-register 或 load-store 系统结构: 只能通过 load 和 store 指令来访问内存.</li><li>memory-memory 系统结构: 现实中不存在.</li></ul><p>GPR 出现的原因:</p><ul><li>寄存器比存储器快.</li><li>编译器使用寄存器很方便, 比使用其他存储形式效率更高.</li><li>寄存器用来存放变量可以减少数据流量, 加速程序运行.</li><li>改善代码密度, 寄存器地址比存储器地址位数少.</li></ul><p>GPR ISA 运算类指令的两个特性:</p><ul><li>ALU 指令中包括两个或者三个操作数. <ul><li>两个操作数的格式中, 有一个即使结构操作数也是源操作数.</li><li>三个操作数格式中, 指令包含一个结果操作数和两个源操作数.</li></ul></li><li>ALU 指令中包括多少个存储器操作数: 从 0 - 3 个不等.</li></ul><p>Reg-Reg(0, 3) GPR 优点在于:</p><ul><li>具有简单, 定长的指令编码.</li><li>具有简单的代码生成模式.</li><li>每条指令运行的时钟周期数相近.</li></ul><p>缺点在于:</p><ul><li><strong>目标代码指令数</strong>比直接访问存储器的系统结构<strong>多</strong>.</li><li>质量你个多和指令密度低使<strong>程序变得很大</strong>.</li></ul><p>Reg-Mem(1, 2) GPR 优点在于:</p><ul><li>数据<strong>不需要专门的载入指令</strong>就可以直接访问.</li><li>指令格式更加易于编码, <strong>代码密度高</strong>.</li></ul><p>缺点在于:</p><ul><li>源操作数在二元操作中被破坏了, <strong>操作数不等价</strong>.</li><li>一体哦啊指令中同时对存储器地址和寄存器号码进行编码, 使得<strong>寄存器数量被限制</strong>.</li><li>操作数位置不同使得<strong>每条指令执行所需的时钟周期不同</strong>.</li></ul><h3 id="存储器寻址" tabindex="-1"><a class="header-anchor" href="#存储器寻址" aria-hidden="true">#</a> 存储器寻址</h3><p>我们讨论的所有指令系统都是<strong>字节寻址</strong>的, 都提供了字节(8 位), 半字(16 位), 和字(32 位) 寻址, 大多数计算机还提供了双字(64 位)寻址.</p><p>对于 Intel 系列指令系统, 一个字是 2 个字节, 而对于 MIPS 来说, 一个字是 4 个字节.</p><p>一个字的地址用其最低地址表示, 在 MIPS 中, 字的起始地址必须是 4 的倍数, 称为<strong>对齐限制</strong>.</p><p><strong>取数指令(Load Word, LW)</strong>: 将数据从存储器拷贝到寄存器的指令.</p><p><strong>存数指令(Store Word, SW)</strong>: 将数据从寄存器拷贝到存储器的指令.</p><p>注意数据存储的大小端, 同时, 对齐限制也会带来一些优化:</p><ul><li>字或者双字整数倍<strong>对齐访问</strong>存储器: 简化硬件实现的复杂性.</li><li>一次不对齐的存储器访问可能会导致多次对齐存储器访问, 对齐访问的程序会运行得比较快.</li></ul><h4 id="寻址方式" tabindex="-1"><a class="header-anchor" href="#寻址方式" aria-hidden="true">#</a> 寻址方式</h4><p>寻址方式即<strong>指令中如何指定所要访问的操作数的地址</strong>. 寻址方式需要指定常量/寄存器/存储器操作数的位置.</p><p>注意:</p><ul><li>立即数通常也被认为是一种存储器寻址方式.</li><li>寄存器不属于存储器寻址.</li><li>分离出依赖于程序计数器的 PC相对寻址.</li></ul><p>常见寻址方式:</p><ul><li>寄存器寻址</li><li>立即数寻址</li><li>位移量寻址</li><li>寄存器间接寻址</li><li>间接寻址</li><li>索引寻址</li><li>存储器间接寻址</li><li>自动递增寻址</li><li>自动递减寻址</li><li>比例寻址</li></ul><p>一般 ISA 支持的基本寻址方式:</p><ul><li>立即数寻址</li><li>位移量寻址</li><li>寄存器间接寻址</li><li>立即数为 8 - 16 位, 位移量为 13 - 16 位</li></ul><h4 id="mips-寻址模式总结" tabindex="-1"><a class="header-anchor" href="#mips-寻址模式总结" aria-hidden="true">#</a> MIPS 寻址模式总结</h4><p><strong>立即数寻址</strong>: 操作数是指令中的常数.</p><figure><img src="/assets/ImmediateAddressing-0d10454c.png" alt="ImmediateAddressing" tabindex="0" loading="lazy"><figcaption>ImmediateAddressing</figcaption></figure><p><strong>寄存器寻址</strong>: 操作数是寄存器.</p><figure><img src="/assets/RegisterAddressing-ba1d8607.png" alt="RegisterAddressing" tabindex="0" loading="lazy"><figcaption>RegisterAddressing</figcaption></figure><p><strong>基址寻址</strong>: 操作数在内存中, 其地址是指令中基址寄存器和常数的和.</p><figure><img src="/assets/BaseAddressing-b3b05f50.png" alt="BaseAddressing" tabindex="0" loading="lazy"><figcaption>BaseAddressing</figcaption></figure><p><strong>PC 相对寻址</strong>: 地址是 PC 和指令中常数的和.</p><figure><img src="/assets/BaseAddressing_PC-d06399c7.png" alt="BaseAddressingOfPC" tabindex="0" loading="lazy"><figcaption>BaseAddressingOfPC</figcaption></figure><p><strong>伪直接寻址</strong>: 跳转地址由指令中 26 位字段和 PC 高位相连而成.</p><figure><img src="/assets/BaseAddressing_PseudoDirect-3c4fa9c8.png" alt="BaseAddressing_PseudoDirect" tabindex="0" loading="lazy"><figcaption>BaseAddressing_PseudoDirect</figcaption></figure><h3 id="操作数" tabindex="-1"><a class="header-anchor" href="#操作数" aria-hidden="true">#</a> 操作数</h3><p>指定操作数类型有两种方法:</p><ul><li>通过操作码的编码来指定, 最常用.</li><li>用硬件解释的字段表示类型.</li></ul><h3 id="指令系统的操作" tabindex="-1"><a class="header-anchor" href="#指令系统的操作" aria-hidden="true">#</a> 指令系统的操作</h3><p>大多数指令集系统支持的操作:</p><ul><li>算数和逻辑运算: 定点算数与逻辑操作, 如: 加/减/乘/除/与/或/非.</li><li>数据传输: Load-Store 指令.</li><li>控制: 条件转移/跳转/过程调用和返回/陷阱</li><li>系统: 操作系统调用/虚拟存储器管理指令.</li><li>浮点: 浮点数操作.</li><li>十进制</li><li>字符串</li><li>图像</li></ul><p>指令系统有一个共同的规律: <strong>使用最多的都是一些简单的指令</strong>. 一般来说, 所有的计算机都应该支持前三种指令, 而对后几类指令的支持可能为 0, 也可能有大量的特殊指令.</p><h3 id="控制流指令" tabindex="-1"><a class="header-anchor" href="#控制流指令" aria-hidden="true">#</a> 控制流指令</h3><p>控制流指令包括:</p><ul><li>条件转移</li><li>跳转</li><li>过程调用</li><li>过程返回</li></ul><p>控制流指令的寻址方式中, 一般要知名转移的目标地址, 但返回过程是个例外, 因为编译时不知道返回地址.</p><p>如果使用 <strong>PC 相对寻址</strong>, 即使用基于程序计数器的位移量来指定目标地址, PC 相对寻址有如下优点:</p><ul><li>目标指令与当前指令距离不远, 使用相对偏移地址可以<strong>缩减指令长度</strong>.</li><li>使用相对寻址的程序可以载入到主存的任何位置, 称为位置无关, 对在链接时才执行的程序可以减少工作量.</li></ul><p>如果使用<strong>寄存器间接跳转</strong>, 由于编译时不知道目标的位置, 为了实现返回和间接跳转, 需要使用寄存器进行间接跳转: 给出包含目标地址的寄存器名称.</p><p>寄存器间接跳转还支持:</p><ul><li>分支选择语句 case 或者 switch</li><li>面向对象语言中的虚拟函数或者方法</li><li>高阶函数或者函数指针</li><li>动态共享库</li></ul><p>对于条件转移来说, 实现方案有如下三种:</p><ol><li>条件码</li><li>条件寄存器</li><li>比较并转移</li></ol><p>过程调用的实现方案有两种基本/传统的方法, 用来保存子程序使用的寄存器:</p><ol><li><strong>调用者保存</strong>: 调用者调用其他过程时, 必须保存在调用过程后还要使用的寄存器, 被调用者无需维维护这些寄存器.</li><li><strong>被调用者保存</strong>: 被调用的过程需要保存它使用的寄存器, 调用者不受这些限制.</li></ol><p>有时候, 如果两个调用者都需要访问相同的全局变量时, 必须使用<strong>调用者保存方法</strong>. 大多数时机编译器会综合两种方法使用.</p><h3 id="指令系统的编码" tabindex="-1"><a class="header-anchor" href="#指令系统的编码" aria-hidden="true">#</a> 指令系统的编码</h3><p>指令编码包括: 操作/寄存器地址/寻址方式编码, 指令编码会影响处理器的实现和编译后程序的大小.</p><p>如何将寻址方式和操作通过编码结合到一起?</p><ul><li>独立寻址标识符字段(显式).</li><li>寻址方式由操作码隐含指定, 如 Load-Store 指令.</li></ul><p>编码主要有三种方式:</p><ol><li>变长编码: 允许所有的操作使用所有的寻址方式, 适合寻址方式和操作比较多的情况. 译码复杂, 不适合流水线.</li><li>定长编码: 把操作和寻址方式组合在操作码中, 通常所有的指令长度都相同. 适合寻址方式和操作较少的情况. 译码简单, 适合流水线, 代码量大.</li><li>混合编码: 减少过多的指令, 以减轻多种结构的指令带来的工作负担, 但是仍然提供多种长度指令以减少代码长度.</li></ol><p>如果注重性能, 就选择定长编码; 如果关注代码量大小, 就使用变长编码; 折中可以选择混合编码.</p><h3 id="mips-系统结构指令和寻址特点" tabindex="-1"><a class="header-anchor" href="#mips-系统结构指令和寻址特点" aria-hidden="true">#</a> MIPS 系统结构指令和寻址特点</h3><p>MIPS 是一种简单 64 位 Load-Store 系统结构, 使用固定长度编码, 译码简单, 有利于实现高效流水线, 也可以使编译器产生更高效的目标代码.</p><p>MIPS 有 <strong>32 个 64 位通用寄存器</strong>(GPR), 名称为 R0, R1, ..., R31, 也称为寄存器, 其中, <strong>R0 的值始终为 0</strong>; MIPS 还有 <strong>32 个浮点寄存器</strong>(FPR), 名称为 F0, F1, ..., F31, 既可以作为 32 个 32 位单精度寄存器来使用, 也可以作为 32 个 64 位双精度寄存器来使用.</p><p><strong>MIPS 的数据类型包括主要分为两类: 定点类型和浮点类型</strong>. 定点数据类型有 8 位字节, 16 位半字, 32 位字和 64 位双字; 浮点数有 32 位单精度和 64 位双精度浮点数.</p><p>MIPS 数据传输的寻址方式有三种, 使用 16 位立即数:</p><ul><li><strong>16 位位移量方式(基址寻址)</strong>: 操作数地址是一个存放在寄存器中的基址与相对该基址的 16 位偏移量相加获得.</li><li><strong>位移量为 0 -- 寄存器间接寻址</strong>.</li><li><strong>R0 作为基址寄存器 -- 16 位绝对寻址</strong>.</li></ul><p>MIPS 的存储器是使用 64 位地址字节寻址的.</p><p>MIPS 指令格式如下:</p><ul><li><strong>指令长度为 32 位, 其中 6 位是基本操作码</strong>, 可以使机器更容易进行流水线操作和译码.</li><li><strong>两种存储器寻址方式被编码到操作码中</strong>.</li></ul><p>具体如下:</p><ul><li>I 型指令: <img src="data:image/png;base64,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" alt="I-StructInstruction" loading="lazy"><ul><li>加载/存储字节/半字/字/双字</li><li>立即数-寄存器运算: rt &lt;- rs, OP 立即数</li><li>条件分支指令: rs 表示寄存器, rt 表示未使用</li><li>跳转寄存器/跳转并链接寄存器: rt = 0, rs 表示目标, 立即数为 0</li></ul></li><li>R 型指令: <img src="data:image/png;base64,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" alt="R-StructInstruction" loading="lazy"><ul><li>寄存器-寄存器 ALU 操作: rd &lt;- rs funct rt</li><li>funct 编码数据通路操作: Add, Sub, ...</li><li>移位, 读/写专用寄存器和数据移动</li></ul></li><li>J 型指令: <img src="data:image/png;base64,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" alt="J-StructInstruction" loading="lazy"><ul><li>跳转, 跳转并链接</li><li>陷阱, 从异常中返回</li></ul></li></ul><p>MIPS 的操作大致分为 4 类:</p><ol><li>载入和存储</li><li>ALU 操作</li><li>分支和跳转</li><li>浮点操作</li></ol><p>所有的通用寄存器与浮点数寄存器都可以被载入或存储, 唯一的例外是载入 R0 无效.</p><p>所有的 ALU 指令都是 Reg-Reg 指令, 包括算数和逻辑操作, 并且, 都支持立即寻址方式.</p><h2 id="流水线技术" tabindex="-1"><a class="header-anchor" href="#流水线技术" aria-hidden="true">#</a> 流水线技术</h2><h3 id="基本概念" tabindex="-1"><a class="header-anchor" href="#基本概念" aria-hidden="true">#</a> 基本概念</h3><p>流水线是利用执行指令操作之间的并行性, 实现<strong>多条指令重叠执行</strong>的技术. 当今, 流水线是实现更快 CPU 的基本和关键技术.</p><p>机器周期(流水线周期): 指令沿流水线移动一个流水段的时间. 长度取决于最慢的流水段, 一般是一个时钟周期(有时是两个).</p><p><strong>每个流水线周期从指令流水线流出一条指令</strong>.</p><p><strong>吞吐量</strong>: 单位时间从流水线流出的指令数.</p><p>流水线重叠方式需要解决一些问题:</p><ol><li>为了实现取指/分析指令/执行指令同时进行, 需要对应的独立部件(并且<strong>暂存中件结果</strong>, 如: 流水线锁存器).</li><li>尽量缩短各功能部件的运行速度, 使其大致相等, 避免在重叠中相互等待.</li><li>主存访问冲突.</li></ol><p>访存冲突解决方式:</p><ol><li><strong>将主存分为两个独立编制的存储器</strong>: 指令存储器和数据存储器, CPU 可以分别独立访问.</li><li><strong>低位交叉存取方式</strong>: 可并行访问不在同一个存储体中的指令或者数据.</li><li><strong>指令预取</strong>: 在重叠操作中, 当前一条指令在执行过程中就需要提前去除后面的指令进行相应处理, 称为先行(预取).</li></ol><p>流水线分类:</p><ul><li>按照各过程段用时是否相等分: 均匀流水线/非均匀流水线</li><li>按处理数据类型分: 标狼流水处理机/向量流水处理及</li><li>按流水线规模分: 操作流水线/指令流水线/宏流水线</li><li>按功能分: 单功能流水线/多功能流水线</li><li>按工作方式分: 静态流水线/动态流水线<br> 静态流水线需要等待一类任务执行完成才能执行下一类任务, 而动态流水线不需要(见下图).</li><li>按连接方式: 线性流水线/非线性流水线</li></ul><figure><img src="/assets/StaticAndDynamicAssemblyLine-872bdd7a.png" alt="StaticAndDynamicAssemblyLine" tabindex="0" loading="lazy"><figcaption>StaticAndDynamicAssemblyLine</figcaption></figure><p>流水线的特点:</p><ul><li>流水线处理的最好是<strong>连续任务</strong>, 只有连续任务才能发挥流水线的效率.</li><li>流水线是将一个大的功能部件<strong>分解</strong>为多个子过程.</li><li>流水线中每个功能部件的后面都要有一个<strong>缓冲寄存器</strong>, 也成为<strong>锁存器</strong>, 用于平滑各个功能段延时的不一致.</li><li>流水线中各段时间应尽可能相等, 避免过长导致相互等待.</li><li>流水线有装入时间和排空时间.</li></ul><h3 id="流水线时空图及性能分析" tabindex="-1"><a class="header-anchor" href="#流水线时空图及性能分析" aria-hidden="true">#</a> 流水线时空图及性能分析</h3><h4 id="时空图" tabindex="-1"><a class="header-anchor" href="#时空图" aria-hidden="true">#</a> 时空图</h4><p>时空图从时间和空间两个方面描述了流水线的工作过程. 横轴代表时间, 纵轴代表流水线的各个<strong>段</strong>.</p><h5 id="各段时间相等的时空图" tabindex="-1"><a class="header-anchor" href="#各段时间相等的时空图" aria-hidden="true">#</a> 各段时间相等的时空图</h5><figure><img src="/assets/AssemblyLine-15c96877.png" alt="AssemblyLine" tabindex="0" loading="lazy"><figcaption>AssemblyLine</figcaption></figure><p>吞吐率: 单位时间内, 流水线完成的任务数量或输出结果的数量.</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mi>P</mi><mo>=</mo><mfrac><mi>n</mi><msub><mi>T</mi><mi>k</mi></msub></mfrac></mrow><annotation encoding="application/x-tex"> TP = \frac{n}{T_k} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">TP</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.9436em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 是任务数, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">T_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是处理完成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个任务所需的时间.</p><figure><img src="/assets/AssemblyLineTimeUsage-98bf8398.png" alt="AssemblyLineTimeUsage" tabindex="0" loading="lazy"><figcaption>AssemblyLineTimeUsage</figcaption></figure><p>假设流水线为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 段流水线, 完成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个任务所需的时间为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mi>k</mi></msub><mo>=</mo><mi>k</mi><mi mathvariant="normal">Δ</mi><mi>t</mi><mo>+</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">Δ</mi><mi>t</mi><mo>=</mo><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex"> T_k = k \Delta t + (n - 1) \Delta t = (k + n - 1) \Delta t </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></span></p><p>流水线实际吞吐率为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mi>P</mi><mo>=</mo><mfrac><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> TP = \frac{n}{(k + n - 1) \Delta t} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">TP</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0436em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>最大吞吐率为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><msub><mi>P</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>=</mo><munder><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>n</mi><mo>→</mo><mi mathvariant="normal">∞</mi></mrow></munder><mfrac><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> TP_{max} = \lim_{n \to \infty} \frac{n}{(k + n - 1) \Delta t} = \frac{1}{\Delta t} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0436em;vertical-align:-0.936em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.4em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">→</span><span class="mord mtight">∞</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">lim</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h5 id="各段时间不同的流水线" tabindex="-1"><a class="header-anchor" href="#各段时间不同的流水线" aria-hidden="true">#</a> 各段时间不同的流水线</h5><figure><img src="/assets/AssemblyLineWithNotSameTime-98f70902.png" alt="AssemblyLineWithNotSameTime" tabindex="0" loading="lazy"><figcaption>AssemblyLineWithNotSameTime</figcaption></figure><p><strong>流水线中时间最长的段称为流水线的瓶颈段</strong>.</p><p>解决瓶颈问题的方法:</p><ol><li>细分瓶颈段</li><li>重复设置瓶颈段</li></ol><p><strong>细分瓶颈段</strong>:</p><figure><img src="/assets/BottleneckStageSubdivision-e285afc2.png" alt="BottleneckStageSubdivision" tabindex="0" loading="lazy"><figcaption>BottleneckStageSubdivision</figcaption></figure><p><strong>重复设置瓶颈段</strong>:</p><p>控制逻辑更复杂, 需要增加硬件.</p><figure><img src="/assets/BottleneckStageRepeat-c3091b59.png" alt="BottleneckStageRepeat" tabindex="0" loading="lazy"><figcaption>BottleneckStageRepeat</figcaption></figure><h4 id="性能分析" tabindex="-1"><a class="header-anchor" href="#性能分析" aria-hidden="true">#</a> 性能分析</h4><p>衡量流水线性能主要有三个指标: <strong>吞吐率</strong>, <strong>加速比</strong>, <strong>效率</strong>.</p><h5 id="加速比" tabindex="-1"><a class="header-anchor" href="#加速比" aria-hidden="true">#</a> 加速比</h5><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo>=</mo><mfrac><msub><mi>T</mi><mi>S</mi></msub><msub><mi>T</mi><mi>K</mi></msub></mfrac></mrow><annotation encoding="application/x-tex"> S = \frac{T_S}{T_K} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>S</mi></msub></mrow><annotation encoding="application/x-tex">T_S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为不使用流水线所用时间, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>K</mi></msub></mrow><annotation encoding="application/x-tex">T_K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为使用流水线所用时间.</p><p>对于各段时间相等的流水线:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo>=</mo><mfrac><mrow><mi>n</mi><mi>k</mi></mrow><mrow><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex"> S = \frac{nk}{k + n - 1} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1408em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">nk</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>最大加速比为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>=</mo><munder><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>n</mi><mo>→</mo><mi mathvariant="normal">∞</mi></mrow></munder><mfrac><mrow><mi>n</mi><mi>k</mi></mrow><mrow><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mi>k</mi></mrow><annotation encoding="application/x-tex"> S_{max} = \lim_{n \to \infty} \frac{nk}{k + n - 1} = k </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1408em;vertical-align:-0.7693em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.4em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">→</span><span class="mord mtight">∞</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">lim</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">nk</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span></p><h5 id="效率" tabindex="-1"><a class="header-anchor" href="#效率" aria-hidden="true">#</a> 效率</h5><p>流水线效率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> 指 流水线的设备利用率. 在时空图上, <strong>流水线的效率定义为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个任务占用的时空区与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个功能段总的时空区之比</strong>.</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><msub><mi>T</mi><mn>0</mn></msub><mrow><mi>k</mi><mo>∗</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> E = \frac{T_0}{k * T_k} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个任务占用的时空区即<strong>顺序执行 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个任务所需的时间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">T_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></strong>, 一条 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 段流水线完成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个任务所用的总时空区为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>∗</mo><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">k * T_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">T_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是流水线完成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个任务所用的总时间.</p><p>一条 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 段流水线的效率为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mi>n</mi><mrow><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex"> E = \frac{n}{k + n - 1} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8769em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>最大效率为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>E</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>=</mo><munder><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>n</mi><mo>→</mo><mi mathvariant="normal">∞</mi></mrow></munder><mfrac><mi>n</mi><mrow><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> E_{max} = \lim_{n \to \infty} \frac{n}{k + n - 1} = 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8769em;vertical-align:-0.7693em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.4em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">→</span><span class="mord mtight">∞</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">lim</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p><h3 id="risc-指令系统特点" tabindex="-1"><a class="header-anchor" href="#risc-指令系统特点" aria-hidden="true">#</a> RISC 指令系统特点</h3><p>RISC 系统有如下关键特点:</p><ol><li>所有参加运算的数据来自寄存器, 结果也写入寄存器, 寄存器为 32/64 位.</li><li>访存只有 load/store 指令.</li><li>指令数量较少, 所有指令长度相同.</li></ol><p>这种结构可以有效<strong>简化流水线</strong>.</p><p>MIPS 系统是默认的 RISC 系统.</p><h3 id="非流水线下-risc-指令系统的实现" tabindex="-1"><a class="header-anchor" href="#非流水线下-risc-指令系统的实现" aria-hidden="true">#</a> 非流水线下 RISC 指令系统的实现</h3><h4 id="单周期" tabindex="-1"><a class="header-anchor" href="#单周期" aria-hidden="true">#</a> 单周期</h4><figure><img src="/assets/RISC_SingleCycleImplementation-c8d1348f.png" alt="RISC_SingleCycleImplementation" tabindex="0" loading="lazy"><figcaption>RISC_SingleCycleImplementation</figcaption></figure><p>单周期, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>P</mi><mi>I</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">CPI = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>, 很少使用.</p><h4 id="多周期" tabindex="-1"><a class="header-anchor" href="#多周期" aria-hidden="true">#</a> 多周期</h4><figure><img src="/assets/RISC_MultiCycleImplementation-67aa5bc0.png" alt="RISC_MultiCycleImplementation" tabindex="0" loading="lazy"><figcaption>RISC_MultiCycleImplementation</figcaption></figure><p>上图有五个周期:</p><ol><li>取指(InstructionFetch, IF) <ul><li>按照 PC 内容访问指令寄存器, 取出指令.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>C</mi><mo>+</mo><mn>4</mn><mo>→</mo><mi>N</mi><mi>P</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">PC + 4 \to NPC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">NPC</span></span></span></span>, 为条指令地址.</li></ul></li><li>译码(InstructionDecode, ID) <ul><li>指令译码.</li><li>读寄存器.</li><li>如果需要, 符号扩展指令中的位移量.</li></ul></li><li>执行(Execution, EX) <ul><li>Load/Store: 计算数据存储器有效地址.</li><li>R-R/R-I: 执行计算操作.</li><li>Branch: 做相等测试, 如果相等计算目标地址送 PC.</li></ul></li><li>访存(MemoryAccess, MEM) <ul><li>Load: 送有效地址到数据存储器, 取数据.</li><li>Store: 写 ID 读出数据到有效地址单元中.</li></ul></li><li>写回(WriteBack, WB) <ul><li>Load/ALU: 写结果到寄存器堆.</li></ul></li></ol><p>数据路径中的<strong>暂存器</strong>易于实现流水线.</p><p>注意, Branch/Store 指令只花费 4 个时钟周期.</p><p>若 Branch 执行概率为 %p_{branch}%, Store 执行概率为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{store}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ore</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, 整体 CPI 为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>P</mi><mi>I</mi><mo>=</mo><mn>4</mn><mo>∗</mo><mo stretchy="false">(</mo><msub><mi>p</mi><mrow><mi>b</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi></mrow></msub><mo>+</mo><msub><mi>p</mi><mrow><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>e</mi></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><mn>5</mn><mo>∗</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>p</mi><mrow><mi>b</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi></mrow></msub><mo>−</mo><msub><mi>p</mi><mrow><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>e</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> CPI = 4 * (p_{branch} + p_{store}) + 5 * (1 - p_{branch} - p_{store}) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ore</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ore</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>如此实现没有优化.</p><h4 id="多周期性能改进" tabindex="-1"><a class="header-anchor" href="#多周期性能改进" aria-hidden="true">#</a> 多周期性能改进</h4><ol><li><strong>对于 Branch 指令, 将相等测试和计算可能的转移目标地址提前到 ID</strong>, 如此 Branch 指令只占用两个时钟周期.</li><li><strong>完成 ALU 指令提前到 MEM</strong>, 如此 ALU 指令只占用 4 个时钟周期.</li></ol><p>改进后, CPI 为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>P</mi><mi>I</mi><mo>=</mo><mn>2</mn><mo>∗</mo><msub><mi>p</mi><mrow><mi>b</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi></mrow></msub><mo>+</mo><mn>4</mn><mo>∗</mo><mo stretchy="false">(</mo><msub><mi>p</mi><mrow><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>e</mi></mrow></msub><mo>+</mo><msub><mi>p</mi><mrow><mi>a</mi><mi>l</mi><mi>u</mi></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><mn>5</mn><mo>∗</mo><msub><mi>p</mi><mrow><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> CPI = 2 * p_{branch} + 4 * (p_{store} + p_{alu}) + 5 * p_{load} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ore</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><figure><img src="/assets/RISC_OptimizedMultiCycleImplementation-9fa521c3.png" alt="RISC_OptimizedMultiCycleImplementation" tabindex="0" loading="lazy"><figcaption>RISC_OptimizedMultiCycleImplementation</figcaption></figure><p>还可以<strong>改进硬件冗余</strong>, 将 ALU 共享, 数据和指令存储器可以合并, 因为访问发生在不同的时钟周期.</p><h3 id="经典-5-段流水线-risc-处理器" tabindex="-1"><a class="header-anchor" href="#经典-5-段流水线-risc-处理器" aria-hidden="true">#</a> 经典 5 段流水线 RISC 处理器</h3><p>5 个段构成一个流水线, 一条指令经过每一个段. 由此, CPI 减少到 1, 因为每个时钟周期发射或者完成一条指令. 同时, 在任一时钟周期, 每个流水段正执行一条指令的部分.</p><figure><img src="/assets/Classic5StageAssemblyLineRISC-4a83d80a.png" alt="Classic5StageAssemblyLineRISC" tabindex="0" loading="lazy"><figcaption>Classic5StageAssemblyLineRISC</figcaption></figure><figure><img src="/assets/5StageMIPSDatapath-0f181efb.png" alt="5StageMIPSDatapath" tabindex="0" loading="lazy"><figcaption>5StageMIPSDatapath</figcaption></figure><p>流水线减少执行时间的方法:</p><ol><li>对于每条指令执行用一个时钟周期的机器(单周期实现), <strong>流水线减少时钟周期</strong>.</li><li>对于每条指令执行用多个时钟周期的机器(多周期实现), <strong>流水线减少 CPI</strong>.</li></ol><h4 id="流水线寄存器" tabindex="-1"><a class="header-anchor" href="#流水线寄存器" aria-hidden="true">#</a> 流水线寄存器</h4><p>由于流水线每个周期都要取出一条指令, 那么先前取出正在执行的指令会被覆盖, 我们需要使用流水线寄存器来保存从存储器中取出的指令. 同时, 每级都要保存目的寄存器编号.</p><p>引入流水线后, 会出现一些问题:</p><p>同一时钟周期内, 不同操作不能使用同一数据通路资源(结构冒险, Structure Hazard).</p><p>引入后, 会出现<strong>访问存储器冲突</strong>, 解决方式为<strong>使用分开的指令 Cache 和数据 Cache</strong>. 如果时钟周期不变, 流水线存储系统的带宽必须是非流水线的 5 倍.</p><figure><img src="/assets/5StageMultiAssemblyLineRISC_StructureHazard_MEM-5fa01b7f.png" alt="5StageMultiAssemblyLineRISC_StructureHazard_MEM" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_StructureHazard_MEM</figcaption></figure><figure><img src="/assets/5StageMultiAssemblyLineRISC_StructureHazard_MEM_Solution-39e76fed.png" alt="5StageMultiAssemblyLineRISC_StructureHazard_MEM_Solution" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_StructureHazard_MEM_Solution</figcaption></figure><p>同时, 也可能发生<strong>寄存器冲突</strong>, 同一时钟周期可能会有读/写寄存器操作, 发生冲突. 解决方式为允许在同一个时钟周期 <strong>WB 段先写, ID 段后读</strong>.</p><p>如果是在同一时钟周期内, 针对同一个寄存器的读写, 就会发生数据冒险(Data Hazard).</p><figure><img src="/assets/5StageMultiAssemblyLineRISC_StructureHazard_Register-a18bd214.png" alt="5StageMultiAssemblyLineRISC_StructureHazard_Register" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_StructureHazard_Register</figcaption></figure><figure><img src="/assets/5StageMultiAssemblyLineRISC_StructureHazard_Register_Solution-09fbbe1c.png" alt="5StageMultiAssemblyLineRISC_StructureHazard_Register_Solution" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_StructureHazard_Register_Solution</figcaption></figure><p>更新 PC 时, 也可能发生冲突, 由于<strong>每个时钟周期都需要增量 PC 并存储到 PC</strong>, 如果遇到转移指令, 需要改变 PC 的值, 但是条件转移地址需要等到 ID 段才能获得, 如果转移发生, 那么会取出并执行一条无效的指令. 这称为控制冒险(Control Hazard).</p><p><strong>流水线寄存器用于保证不同段的指令不会相互干扰. 任何后面段需要的值都必须放到流水线寄存器中, 并且会复制到后面的寄存器中, 直到不需要为止</strong>.</p><h3 id="流水线冒险" tabindex="-1"><a class="header-anchor" href="#流水线冒险" aria-hidden="true">#</a> 流水线冒险</h3><h4 id="冒险分类与有停顿流水线性能" tabindex="-1"><a class="header-anchor" href="#冒险分类与有停顿流水线性能" aria-hidden="true">#</a> 冒险分类与有停顿流水线性能</h4><p>冒险分类如下:</p><ul><li>结构冒险: 指令重叠执行时, 发生硬件资源冲突.</li><li>数据冒险: 指令重叠执行时, 一条指令依赖前一条指令的执行结果但是没有准备好.</li><li>控制冒险: 下一个时钟周期取指令时, 转移条件和转移 PC 是不可用的.</li></ul><p>冒险总是可以用停顿解决的. 停顿会为某些指令暂停一定时钟周期, 当一条指令被停顿后, 其后的所有指令都会被停顿, 该指令之前的指令会继续执行. 停顿时, 也不会有任何新的指令被取到流水线. 流水线停顿也被称为流水线气泡.</p><h4 id="结构冒险-流水段竞争" tabindex="-1"><a class="header-anchor" href="#结构冒险-流水段竞争" aria-hidden="true">#</a> 结构冒险: 流水段竞争</h4><p>解决方式:</p><ul><li>停顿.</li><li>资源重复. <ul><li>多重访问寄存器堆.</li><li>多重访问存储器.</li><li>充分流水功能部件.</li></ul></li></ul><p>对于寄存器读写冲突:</p><ol><li>插入停顿, 但会降低加速比.</li><li>采用 WB 先写, ID 后读的方式.</li></ol><p>对于存储访问冲突:</p><ol><li>插入停顿.</li><li>提供另一个存储器端口.</li><li>使用分开的指令存储器和数据存储器.</li><li>使用指令缓冲器.</li></ol><h4 id="数据冒险" tabindex="-1"><a class="header-anchor" href="#数据冒险" aria-hidden="true">#</a> 数据冒险</h4><p>对于同一周期内对同一寄存器的读写, 同样使用 WB 先写, ID 后读的方式解决.</p><p>对于不同周期内对同一寄存器的数据依赖, 解决思路为: 不让指令在数据冒险时重叠执行.</p><p>不让有冒险的指令流过流水线, 即: 流水线停顿. 实现方式可以通过软件方式, 由编译器插入 nop 指令; 也可以通过硬件方式, 增加硬件互锁(Interlock), 增加硬件检测需要停顿的情况, 增加硬件放&quot;气泡(暂停)&quot;到流水线.</p><figure><img src="/assets/5StageMultiAssemblyLineRISC_DataHazard_Solution_Nop-8c005114.png" alt="5StageMultiAssemblyLineRISC_DataHazard_Solution_Nop" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_DataHazard_Solution_Nop</figcaption></figure><figure><img src="/assets/5StageMultiAssemblyLineRISC_DataHazard_Solution_Interlock-7adb307f.png" alt="5StageMultiAssemblyLineRISC_DataHazard_Solution_Interlock" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_DataHazard_Solution_Interlock</figcaption></figure><p>除了上述两种方式, 还有可能的情况: 有数据冒险的指令的结果已经计算出来, 存放在了流水线寄存器中, 只是不在寄存器堆中. 此时, 可以使用<strong>前推</strong>的方法, 在数据通路上增加数据线(<strong>buses</strong>) 传送这些结果, buses 在数据通路中总是从后面的流水段连接到前面的流水段.</p><figure><img src="/assets/5StageMultiAssemblyLineRISC_DataHazard_Solution_Forwarding-0bc0cd2b.png" alt="5StageMultiAssemblyLineRISC_DataHazard_Solution_Forwarding" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_DataHazard_Solution_Forwarding</figcaption></figure><p>上图中, 增加了如下数据前推的数据线:</p><ol><li>EX/MEM.AluOutput --&gt; AluInput (红色箭头)</li><li>MEM/WB.AluOutput --&gt; AluInput (蓝色箭头)</li><li>MEM/WB.LMD --&gt; AluInput (紫色箭头)</li></ol><figure><img src="/assets/5StageMultiAssemblyLineRISC_DataHazard_Solution_Forwarding_Others-582d128b.png" alt="5StageMultiAssemblyLineRISC_DataHazard_Solution_Forwarding_Others" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_DataHazard_Solution_Forwarding_Others</figcaption></figure><p>上图展示了前推可能的其他路径(红色), 主要作用于 Load/Store 指令, 即: MEM/WB.LMD --&gt; DMInput.</p><p>当然, 前推也有不能解决的问题, 如: 在同一周期内, 数据的产生在周期结束, 而数据依赖在周期开始, 此时前推无法提供数据. 不过, 可以额外在数据依赖指令处插入停顿来解决.</p><p>Load Stall 对 CPI 的影响较大, 很多时候 Load 之后的指令需要 Load 的结果, 就会产生很多 Stall. 对此, 可以在编译阶段, 由编译器进行重排序, 合理避免数据冒险(可以参考 Java 中对 volatile 修饰的变量的读写屏障).</p><h4 id="控制冒险" tabindex="-1"><a class="header-anchor" href="#控制冒险" aria-hidden="true">#</a> 控制冒险</h4><p>下一个时钟周期取指令时, 转移条件和转移 PC 是不可用的, 即在进入 ID 段时, 转移条件和转移目标地址, 不能按时提供给 IF 段取指令.</p><p><strong>控制冒险引起 MIPS 的性能损失比数据冒险大得多</strong>.</p><p>下图为条件转移的原理图:</p><figure><img src="/assets/5StageMultiAssemblyLineRISC_Transition-f4f87de5.png" alt="5StageMultiAssemblyLineRISC_Transition" tabindex="0" loading="lazy"><figcaption>5StageMultiAssemblyLineRISC_Transition</figcaption></figure><p>可见, 控制冒险发生在 MEM 周期和 IF 周期交接时, 下一个 IF 将 MEM 的跳转结果覆盖, 导致控制冒险.</p><p>对于控制冒险, 有四种简单解决方法:</p><ol><li>冻结或冲刷流水线.</li><li>预测转移不发生.</li><li>预测转移发生.</li><li>转移延迟.</li></ol><p>但是, 上述方法都会使硬件固定. 编译时, 会根据<strong>硬件机制</strong>和<strong>转移行为</strong>对代码进行调度, 来获取最佳性能.</p><p>在转移预测中, 通常的改进方法会将转移计算从 EX+MEM 提前到 ID 甚至 EX 阶段.</p><h2 id="增加内容流水线处理机及其设计" tabindex="-1"><a class="header-anchor" href="#增加内容流水线处理机及其设计" aria-hidden="true">#</a> 增加内容流水线处理机及其设计</h2><h3 id="流水线处理机的指令系统和格式" tabindex="-1"><a class="header-anchor" href="#流水线处理机的指令系统和格式" aria-hidden="true">#</a> 流水线处理机的指令系统和格式</h3><ul><li>ALU 操作指令: and/or/add/sub</li><li>存储器访问指令: load/store</li><li>条件转移指令: bne/beq</li><li>无条件转移指令: branch</li></ul><p>注意:</p><ul><li>ALU 指令处理把运算结果写入寄存器堆外, 也会把 ZERO 标志写入 Z 寄存器.</li><li>条件转移指令使用 Z 标志决定是否转移.</li><li>指令长度: 32 位, 地址: 32 位.</li><li>设定指令存储器和数据存储器的存储单元为 32 位, 按字寻址.</li><li>每次按 PC 取指令后, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>C</mi><mo>+</mo><mn>1</mn><mo>→</mo><mi>P</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">PC + 1 \to PC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span></span></span></span>.</li></ul><figure><img src="/assets/ComplexSingleStageProcessorImplementation-286e4db0.png" alt="ComplexSingleStageProcessorImplementation" tabindex="0" loading="lazy"><figcaption>ComplexSingleStageProcessorImplementation</figcaption></figure><p>一些指令的具体执行流程如下:</p><figure><img src="/assets/Execution_Add-53ad1fb8.png" alt="Execution_Add" tabindex="0" loading="lazy"><figcaption>Execution_Add</figcaption></figure><figure><img src="/assets/Execution_Addi-f3690b37.png" alt="Execution_Addi" tabindex="0" loading="lazy"><figcaption>Execution_Addi</figcaption></figure><figure><img src="/assets/Execution_load-fd29a406.png" alt="Execution_load" tabindex="0" loading="lazy"><figcaption>Execution_load</figcaption></figure><figure><img src="/assets/Execution_store-2691bcd7.png" alt="Execution_store" tabindex="0" loading="lazy"><figcaption>Execution_store</figcaption></figure><figure><img src="/assets/Execution_branch-40a9b124.png" alt="Execution_branch" tabindex="0" loading="lazy"><figcaption>Execution_branch</figcaption></figure><p>下面是 5 级流水线中使用的流水线寄存器:</p><figure><img src="/assets/AssemblyLineRegister_PCAndIR-a640ea02.png" alt="AssemblyLineRegister_PCAndIR" tabindex="0" loading="lazy"><figcaption>AssemblyLineRegister_PCAndIR</figcaption></figure><ul><li>PC(32 位): 程序计数器, 程序不转移时, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>C</mi><mo>+</mo><mn>1</mn><mo>→</mo><mi>P</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">PC + 1 \to PC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span></span></span></span>; 发生转移时, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>C</mi><mo>+</mo><mi>E</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>d</mi><mi>O</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>→</mo><mi>P</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">PC + ExtendedOffset \to PC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">ff</span><span class="mord mathnormal">se</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span></span></span></span>.</li><li>指令寄存器 IR(32 位): IF 和 ID 之间的流水线寄存器.</li></ul><figure><img src="/assets/AssemblyLineRegister_ID-EX-2ee0d88e.png" alt="AssemblyLineRegister_ID-EX" tabindex="0" loading="lazy"><figcaption>AssemblyLineRegister_ID-EX</figcaption></figure><p>在 ID 和 EX 段之间:</p><ul><li>寄存器堆中读出的 A, B 数据需要保存.</li><li>经过符号扩展之后的立即数 I 需要保存.</li><li>使用一个 d 寄存器(5 位)来保存目的寄存器号, 因为指令操作的结果要在 WB 级写回寄存器堆, 多以需要同步目的寄存器号.</li></ul><figure><img src="/assets/AssemblyLineRegister_EX-MEM-5d3f6d45.png" alt="AssemblyLineRegister_EX-MEM" tabindex="0" loading="lazy"><figcaption>AssemblyLineRegister_EX-MEM</figcaption></figure><p>在 EX 和 MEM 段之间:</p><ul><li>Z(1 位): 存放 ALU 的 ZERO 标志位, 在执行条件转移指令时, 用 Z 决定是否转移.</li><li>R(32 位): 存放 ALU 计算结果(ALU/load/store).</li><li>S(32 位): 专用于 store 指令, 用于存放要写入寄存器的 32 位数据.</li></ul><figure><img src="/assets/AssemblyLineRegister_MEM-WB-8c12baf1.png" alt="AssemblyLineRegister_MEM-WB" tabindex="0" loading="lazy"><figcaption>AssemblyLineRegister_MEM-WB</figcaption></figure><p>在 MEM 和 WB 之间:</p><ul><li>D(32 位): 存放 load 指令从存储器中独处的数据.</li><li>C(32 位): 保存前一级的 R, 即 R 型指令的计算结果.</li><li>这一级 d 寄存器的数据用于指定写回操作的目的寄存器号, D 或者 C 的数据要写回到对应的寄存器堆中.</li></ul><p>下图是完整的数据路径和控制信号:</p><figure><img src="/assets/AssemblyLineProcessorDataPathAndControlSignal-a5d91185.png" alt="AssemblyLineProcessorDataPathAndControlSignal" tabindex="0" loading="lazy"><figcaption>AssemblyLineProcessorDataPathAndControlSignal</figcaption></figure><p>ID 级的 MUX 用于 store 指令的参数, 如果是 store 指令, 就选择 IR 中的 rd; 如果不是, 就选择 IR 中的 rs2.</p><p>各流水线级控制信号及其意义:</p><table><thead><tr><th>流水线级</th><th>控制信号</th><th>注释</th></tr></thead><tbody><tr><td>IF</td><td>BTAKEN</td><td>转移发生</td></tr><tr><td>ID</td><td>SST</td><td>选择 store(rd)/other(rs2)</td></tr><tr><td>EXE</td><td>SIMM</td><td>选择立即数</td></tr><tr><td>EXE</td><td>ALUOP</td><td>ALU 操作码</td></tr><tr><td>EXE</td><td>WZ</td><td>写 Z 标志</td></tr><tr><td>MEM</td><td>WMEM</td><td>写存储器</td></tr><tr><td>WB</td><td>SLD</td><td>选择 load</td></tr><tr><td>WB</td><td>WREG</td><td>写寄存器堆</td></tr></tbody></table><h3 id="流水线转移指令控制" tabindex="-1"><a class="header-anchor" href="#流水线转移指令控制" aria-hidden="true">#</a> 流水线转移指令控制</h3><p>转移指令包括条件转移和无条件转移, 6 位 OP, 26 位偏移量.</p><ul><li>bne disp: if !Z, PC = PC + disp.</li><li>beq disp: if Z, PC = PC + disp.</li><li>branch disp: PC = PC + disp.</li></ul><p>转移指令在 ID 级由专用加法器计算转移地址, 条件转移指令同时判断转移条件.</p><p>在流水线中, 由编译器插入 nop 指令延迟转移.</p><figure><img src="/assets/TransitionControl_NOP-cd67dd49.png" alt="TransitionControl_NOP" tabindex="0" loading="lazy"><figcaption>TransitionControl_NOP</figcaption></figure><p>对于条件转移指令来说, 需要 EXE 级结束产生的 Z 标志, 故而需要插入两条 nop.</p><p>而对于无条件转移指令来说, 不需要 Z 标志判断, 只需要插入一条 nop.</p><p><strong>转移地址的计算比较重要</strong>, 流程如下:</p><p>如上图 branch 指令第二个时钟周期,</p><ul><li>ID 级计算目标转移地址, 从 IR 获取偏移量进行符号扩展;</li><li>IF 级: nop 取出;</li><li>BTAKEN = 1, 选择符号扩展偏移量 disp;</li><li>地址加法器计算转移目标地址, 等时钟上升沿(本周期结束), 将目标地址打入 PC.</li></ul><figure><img src="/assets/TransitionControl_Branch-4cb07e3c.png" alt="TransitionControl_Branch" tabindex="0" loading="lazy"><figcaption>TransitionControl_Branch</figcaption></figure><p>对于条件转移, 如上图 bne 流水线操作:</p><figure><img src="/assets/TransitionControl_BNEAndBEQ-6ebf0ee8.png" alt="TransitionControl_BNEAndBEQ" tabindex="0" loading="lazy"><figcaption>TransitionControl_BNEAndBEQ</figcaption></figure><ul><li>bne/beq 根据 Z 判断是否转移.</li><li>如果满足, BTAKEN = 1, 转移地址 = PC + disp.</li><li>否则, BTAKEN = 0, PC + 1 计算 nop 下一条顺序指令的位置.</li><li>时钟上升沿到来时, 计算出的地址被打入 PC. 如果是转移目标地址, 则从目标地址取出指令; 否则取 nop 之后的顺序指令.</li><li>综上: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>T</mi><mi>A</mi><mi>K</mi><mi>E</mi><mi>N</mi><mo>=</mo><mi>b</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mo>+</mo><mi>b</mi><mi>n</mi><mi>e</mi><mover accent="true"><mi>Z</mi><mo stretchy="true">‾</mo></mover><mo>+</mo><mi>b</mi><mi>e</mi><mi>q</mi><mi>Z</mi></mrow><annotation encoding="application/x-tex">BTAKEN = branch + bne\overline{Z} + beqZ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">BT</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.10903em;">EN</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">bn</span><span class="mord mathnormal">e</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07153em;">qZ</span></span></span></span>.</li></ul><p><strong>注意: BTAKEN 在 ID 级产生, 但是产生 Z 的指令要早它两个周期.</strong></p><h3 id="流水线数据冒险解决" tabindex="-1"><a class="header-anchor" href="#流水线数据冒险解决" aria-hidden="true">#</a> 流水线数据冒险解决</h3><p><strong>一条指令进入流水线 ID 级, 检测与前面指令可能有数据相关</strong>的<strong>基本条件</strong>是:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>I</mi><msub><mi>D</mi><mi>r</mi></msub><mi>s</mi><mn>1</mn><mo>=</mo><mo>=</mo><mi>E</mi><mi>X</mi><msub><mi>E</mi><mi>r</mi></msub><mi>d</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>I</mi><msub><mi>D</mi><mi>r</mi></msub><mi>s</mi><mn>1</mn><mo>=</mo><mo>=</mo><mi>M</mi><mi>E</mi><msub><mi>M</mi><mi>r</mi></msub><mi>d</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>I</mi><msub><mi>D</mi><mi>r</mi></msub><mi>s</mi><mn>2</mn><mo>=</mo><mo>=</mo><mi>E</mi><mi>X</mi><msub><mi>E</mi><mi>r</mi></msub><mi>d</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>I</mi><msub><mi>D</mi><mi>r</mi></msub><mi>s</mi><mn>2</mn><mo>=</mo><mo>=</mo><mi>M</mi><mi>E</mi><msub><mi>M</mi><mi>r</mi></msub><mi>d</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> (ID_rs1 == EXE_rd) + (ID_rs1 == MEM_rd) + (ID_rs2 == EXE_rd) + (ID_rs2 == MEM_rd) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">EX</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">ME</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">EX</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">ME</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mclose">)</span></span></span></span></span></p><p>其他条件:</p><ul><li>EXE 级和 MEM 级指令的 WREG 信号需要参与检测(区分是写目的寄存器还是 store 指令中的 rd, 因为 store 不会写 rd).</li><li>ID 级指令的源寄存器号 rs2 与立即数部分重叠, 而立即数不会出现相关的.</li><li>ID 级的指令不能是转移指令, 转移指令不需要判断数据相关.</li></ul><p>以上的后两者都是使用操作码来区分的.</p><p>DEPEN 是总的数据是否相关的标志, 可以分为 A_DEPEN 和 B_DEPEN.</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>DEPEN <span class="token operator">=</span> A_DEPEN <span class="token operator">+</span> B_DEPEN
A_DEPEN <span class="token operator">=</span> <span class="token punctuation">(</span>ID_rs1 <span class="token operator">==</span> EXE_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs1IsReg<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ID_rs1 <span class="token operator">==</span> MEM_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>MEM_REG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs1IsReg<span class="token punctuation">)</span>

B_DEPEN <span class="token operator">=</span> <span class="token punctuation">(</span>ID_rs2 <span class="token operator">==</span> EXE_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs2IsReg<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ID_rd <span class="token operator">==</span> EXE_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>ID_rs2 <span class="token operator">==</span> MEM_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs2IsReg<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ID_rd <span class="token operator">==</span> MEM_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A_DEPEN 指 ID 级指令的 rs1 与前面指令的 rd 数据相关. A_DEPEN 指 ID 级指令的 rs2 与前面指令的 rd 数据相关.</p><ul><li>EXE_rd 表示 EXE 级的流水线寄存器 d.</li><li>(EXE_WREG == 1) 表示 I1 的 rd 确实是目的寄存器, 排除 I1 是 store 指令.</li><li>ID_rs1IsReg 条件是为了排除转移指令.</li><li>ID_rs2IsReg 排除立即数运算指令.</li></ul><p>再进行细分:</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>A_DEPEN <span class="token operator">=</span> EXE_A_DEPEN <span class="token operator">+</span> MEM_A_DEPEN
B_DEPEN <span class="token operator">=</span> EXE_B_DEPEN <span class="token operator">+</span> MEM_B_DEPEN
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/5StageAssemblyLineDepenImplementation-63d0fdd0.png" alt="5StageAssemblyLineDepenImplementation" tabindex="0" loading="lazy"><figcaption>5StageAssemblyLineDepenImplementation</figcaption></figure><h4 id="内部前推" tabindex="-1"><a class="header-anchor" href="#内部前推" aria-hidden="true">#</a> 内部前推</h4><p>一条指令执行时, 要用到上面指令的计算结果, 但这个结果尚未写入寄存器堆. 而实际上, 此时结果已经被 ALU 计算出来了, 在流水线寄存器 R 和 C 中.</p><p>我们可以直接在 ALU 的两个数据输出端各加一个多路器, 使 R 和 C 的数据能被直接送到 ALU 的输入端, 即: 内部前推, 或专用数据相关通路.</p><figure><img src="/assets/5StageAssemblyLineForwardingImplementation-f1f1dafe.png" alt="5StageAssemblyLineForwardingImplementation" tabindex="0" loading="lazy"><figcaption>5StageAssemblyLineForwardingImplementation</figcaption></figure><p>MUX 的选择信号和 A_DEPEN 与 B_DEPEN 有关, 区别是不排除转移指令, 因为转移指令在 EXE 级不做任何操作; 但是会检查 rs2 是否为立即数, 因为立即数不与前面指令的结果相关.</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>A_DEPEN1 <span class="token operator">=</span> <span class="token punctuation">(</span>EXE_rs1 <span class="token operator">==</span> MEM_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>MEM_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>EXE_rs1 <span class="token operator">==</span> WB_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>WB_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
B_DEPEN1 <span class="token operator">=</span> <span class="token punctuation">(</span>EXE_rs2 <span class="token operator">==</span> MEM_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>MEM_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs2IsReg<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>EXE_rs2 <span class="token operator">==</span> WB_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>WB_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs2IsReg<span class="token punctuation">)</span>

B_DEPEN0 <span class="token operator">=</span> <span class="token operator">!</span>EXE_rs2IsReg <span class="token operator">+</span> <span class="token operator">!</span><span class="token punctuation">(</span>MEM_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_rs2 <span class="token operator">==</span> WB_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>WB_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">!</span><span class="token punctuation">(</span>EXE_rs2 <span class="token operator">==</span> MEM_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_rs2 <span class="token operator">==</span> WB_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>WB_WREG <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_rs2IsReg<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的方法是在 EXE 级 ALU 操作时才检测数据相关, 我们完全可以在 ID 级完成这项工作, 并把结果(A_DEPEN/B_DEPEN) 作为控制信号打入流水线寄存器.</p><figure><img src="/assets/5StageAssemblyLineDataForwardingImplementation-5112019e.png" alt="5StageAssemblyLineDataForwardingImplementation" tabindex="0" loading="lazy"><figcaption>5StageAssemblyLineDataForwardingImplementation</figcaption></figure><h4 id="load-前推" tabindex="-1"><a class="header-anchor" href="#load-前推" aria-hidden="true">#</a> Load 前推</h4><p><strong>load 指令在 EXE 结束后需要继续访存, 在 MEM 级结束后, 结果才会出现在流水线 D 中</strong>. 这是, 使用内部前推无法消除在 load 和其后的指令之间的第一个气泡.</p><p>如下是实现 load 指令暂停的控制信号表达式, 信号在 ID 级产生:</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>LOAD_DEPEN <span class="token operator">=</span> EXE_A_DEPEN <span class="token operator">+</span> EXE_B_DEPEN

EXE_A_DEPEN <span class="token operator">=</span> <span class="token punctuation">(</span>ID_rs1 <span class="token operator">==</span> EXE_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_SLD <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs1IsReg<span class="token punctuation">)</span>
EXE_B_DEPEN <span class="token operator">=</span> <span class="token punctuation">(</span>ID_rs2 <span class="token operator">==</span> EXE_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_SLD <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ID_rs2IsReg<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ID_rd <span class="token operator">==</span> EXE_rd<span class="token punctuation">)</span><span class="token punctuation">(</span>EXE_SLD <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="流水线异常" tabindex="-1"><a class="header-anchor" href="#流水线异常" aria-hidden="true">#</a> 流水线异常</h2><p>异常是另一种控制冒险. 异常是中断正常程序执行的异常事件, 本文的异常是广义异常, 包括中断和狭义异常.</p><p>中断例子:</p><ul><li>用户敲击键盘.</li><li>网络包到达.</li></ul><p>异常例子:</p><ul><li>除 0.</li><li>溢出.</li><li>缺页.</li></ul><p>当异常发生时, 控制会传递给 OS.</p><figure><img src="/assets/AssemblyLineExceptionHandling-ad90cde5.png" alt="AssemblyLineExceptionHandling" tabindex="0" loading="lazy"><figcaption>AssemblyLineExceptionHandling</figcaption></figure><p>MIPS 可能产生的异常如下:</p><ul><li>IF级: <ul><li>取指时发生缺页.</li><li>存储器访问边界未对齐.</li><li>违反存储器访问权限.</li></ul></li><li>ID 级: <ul><li>未定义的或非法的操作码.</li></ul></li><li>EX 级: <ul><li>算数异常.</li></ul></li><li>MEM 级: <ul><li>存储数据时缺页.</li><li>存储区访问边界未对齐.</li><li>违反了存储器访问权限.</li></ul></li><li>WB 级: <ul><li>无.</li></ul></li></ul><h3 id="异常在-mips-程序中的处理" tabindex="-1"><a class="header-anchor" href="#异常在-mips-程序中的处理" aria-hidden="true">#</a> 异常在 MIPS 程序中的处理</h3><p>异常发生时, 处理器必须要进行的操作是: 在异常程序计数器(EPC)中保存出错指令的地址, 并发控制权转交给 OS 的特定地址.</p><p>在完成处理异常所需动作之后, 操作系统可以终止程序, 也可以继续执行程序, 此时由 EPC 决定重新 开始执行的地方.</p><p>为了处理异常, OS 除了要知道哪条指令引起异常之外, 还必须直到引起异常的原因. 主要有两种方法用于表示异常产生的原因:</p><ol><li>MIPS 设置一个状态寄存器(Cause 寄存器)</li><li>使用向量中断: 控制权被转移到由异常原因决定的地址处(OS 通过异常向量地址直到异常原因).</li></ol><p>流水线如何处理异常?</p><p>异常发生时, 流水线必须被安全关闭, 异常处理完后, 重新启动引起异常的指令.</p><p>具体过程如下:</p><ol><li><strong>强制一个 trap 指令进入流水吸线</strong>.</li><li><strong>禁止异常指令及后面的指令的所有写操作</strong>, 直到 trap 指令流出流水线.</li><li>当 trap 指令开始执行, <strong>唤醒 OS</strong>, OS 保存异常指令的 PC 值.</li><li>OS 处理异常, <strong>然后重新执行出错指令</strong>.</li></ol><h3 id="精确异常" tabindex="-1"><a class="header-anchor" href="#精确异常" aria-hidden="true">#</a> 精确异常</h3><p>如果流水线可以停下来使异常指令之前的指令能正常结束, 异常指令之后的指令能重新启动, 则称该流水线异常是精确异常, 意味着:</p><ul><li>异常指令之前的所有指令正常完成.</li><li>异常指令及其后的指令没有改变机器的状态.</li></ul><p>如此, 重新恢复执行就很简单:</p><ul><li>重新恢复执行异常指令.</li><li>如果它不是一个可恢复执行的指令, 则执行下一条指令.</li></ul><p>执行顺序:</p><p>MIPS 为每条指令设置了一个异常状态, 如果一个异常发生, 就将其添加到对应的向量中, 并禁止所有影响系统状态的写操作. 当一条指令即将离开流水线, 检查是否有挂起未响应的异常. 如果一条指令产生了多个异常, 先响应最早流水段出现的异常.- <a href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84">计算机体系结构</a></p><h3 id="非精确异常" tabindex="-1"><a class="header-anchor" href="#非精确异常" aria-hidden="true">#</a> 非精确异常</h3><p>当不同指令执行需要的时钟周期数有多种时, 难以实现精确异常. 在某条指令产生异常之前, 后面的指令可能已经执行完毕, 称为非精确异常.</p><p>处理器工作在精确异常模式下, 运行速度更慢.</p><p><strong>一般来说, 整数操作异常是精确的, 浮点数操作异常是不精确的</strong>.</p><h2 id="存储层次结构" tabindex="-1"><a class="header-anchor" href="#存储层次结构" aria-hidden="true">#</a> 存储层次结构</h2><h3 id="cache" tabindex="-1"><a class="header-anchor" href="#cache" aria-hidden="true">#</a> Cache</h3><p>Cache 组织的基本单位是块(block, line). Cache 和主存都被分割成相同大小的块, 对 Cache 和主存的访问是以块为基本单位.</p><p><strong>Cache 被插入到主存和 CPU 之间, 使用快速 SRAM 实现, 存储程序的指令和数据部分</strong>.</p><p>Cache 的设计主要考虑如下四个问题:</p><ol><li><strong>块放置</strong>: 把一个 block 从主存调入 Cache 时, 可以放到哪些位置上?</li><li><strong>块识别</strong>: 如何判断要访问的块命中 Cache?</li><li><strong>块替换</strong>: 当访问块不在 Cache 中, 发生失效时, 应该替换哪一块?</li><li><strong>写策略</strong>: 对块进行写时， 采用什么策略?</li></ol><h4 id="映像规则" tabindex="-1"><a class="header-anchor" href="#映像规则" aria-hidden="true">#</a> 映像规则</h4><p>映像包括:</p><ol><li>直接映像: 块只能放在 Cache 中的唯一位置: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>A</mi><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext>  </mtext><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mtext>  </mtext><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>O</mi><mi>f</mi><mi>B</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>C</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">BlockAddress \; \bmod \; NumberOfBlocksInCache</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">Bl</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">A</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">ress</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">u</span><span class="mord mathnormal">mb</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.01968em;">Bl</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span></span></span></span>.</li><li>全相联: 块可以放在 Cache 中的任何位置.</li><li>组相联: 块可以放在 Cache 一组中的任何位置. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>A</mi><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext>  </mtext><mspace></mspace><mspace width="0.6667em"></mspace><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mtext>  </mtext><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>O</mi><mi>f</mi><mi>S</mi><mi>e</mi><mi>t</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>C</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">BlockAddress \; \mod \; NumberOfSetsInCache</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">Bl</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">A</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">ress</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">u</span><span class="mord mathnormal">mb</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span></span></span></span>, 如果一组有 n 块, 称 Cache 为 n 路组相联.</li></ol><h4 id="块识别" tabindex="-1"><a class="header-anchor" href="#块识别" aria-hidden="true">#</a> 块识别</h4><p>Cache 的每一个块都有一个标识 Tag: 存放 CPU 访问数据所在块的主存物理地址的高位部分(主存多块映射到 Cache 一块).</p><p>当 CPU 访问 Cache 时, 比较<strong>主存地址</strong>与<strong>Cache Tag</strong>, 如果两者相同, 则表示 Cache 命中.</p><p>通常, 每个 Cache 还有一个<strong>有效位 valid bit</strong>, 表示 Cache 内容是否有效.</p><p>物理地址的格式:</p><figure><img src="/assets/PhysicalAddress-f94c1ba3.png" alt="PhysicalAddress" tabindex="0" loading="lazy"><figcaption>PhysicalAddress</figcaption></figure><p>对于 Index 字段:</p><ul><li>在直接映像 Cache 中, 选择块.</li><li>在组相联 Cache 中, 选择组.</li><li>索引的位数为: <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><msub><mi>N</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">\log_2N_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> -- 直接映像, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">N_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为块数量.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><msub><mi>N</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">\log_2N_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> -- 组相联, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">N_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为组数量.</li></ul></li></ul><p>对于 ByteOffset 字段:</p><ul><li>选择块中的某个字节.</li><li>位数: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>N</mi></mrow><annotation encoding="application/x-tex">\log_2N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> 为每块的字节数.</li></ul><p>对于 Tag 字段:</p><ul><li>用于查找在 Cache 或一组中的匹配块.</li><li>位数: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>p</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>A</mi><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub><mo>−</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow></msub><mo>−</mo><msub><mi>N</mi><mrow><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>O</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">N_{physicalAddress} - N_{index} - N_{byteOffset}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">ys</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight">dd</span><span class="mord mathnormal mtight">ress</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">ff</span><span class="mord mathnormal mtight">se</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>.</li></ul><h4 id="块替换" tabindex="-1"><a class="header-anchor" href="#块替换" aria-hidden="true">#</a> 块替换</h4><p>对于直接映像, 仅有唯一的一块能够被替换. 而对于全相联或者组相联映像, 有 N 块可以替换, N 为相联度.</p><p>如下为一些块替换策略:</p><ul><li>随机替换: 随机选择替换的一块. <ul><li>硬件容易实现, 只需要一个随机数发生器.</li><li>均匀使用一组中的各块.</li><li>可能替换即将被访问的块.</li></ul></li><li>最近最少使用(Lease-Recently-Used, LRU): 选择一组最近最少使用的块作为被替换块. <ul><li>局部性原理, 假定最近被访问的块可能会被再次访问.</li><li>Cache 中需要额外的位记录访问历史.</li></ul></li><li>先进先出(First-In-First-Out, FIFO): 选择一组中最先进入 Cache 的块.</li></ul><h4 id="写策略" tabindex="-1"><a class="header-anchor" href="#写策略" aria-hidden="true">#</a> 写策略</h4><ol><li>写直达: 数据写入 Cache 的时候, 也同时写入主存. <ul><li>Cache 中的数据可以随时丢弃--主存中有最新数据.</li><li>Cache 控制位只需要一位 valid bit.</li><li>主存或者其他处理器总是有最新的数据.</li></ul></li><li>写回: 写 Cache 时, 不写主存. <ul><li>不能丢弃 Cache 中的数据--可能需要写回到主存.</li><li>Cache 控制位: 需要 valid bit 和 dirty bit(数据是否被污染).</li><li>带宽较小, 因为对同一块的多次写仅需要对主存写一次.</li></ul></li></ol><p>写直达的优点是: 读缺失不会导致替换时的写操作, 保持了数据一致性, 实现简单.</p><p>写回的优点是: 写 Cache 速度更快, 主存带宽更低.</p><p>对于写直达的 Cache 来说, 会有<strong>写停顿</strong>的问题: CPU 必须等待写操作完成. 为解决这个问题, 可以使用<strong>写缓冲</strong>:</p><ul><li>一个小的缓冲区, 存放等待写入主存的几个值.</li><li>在写操作集中时, 作用较大.</li><li>不能完全消除停顿(如: 写的数据量大于缓冲区).</li></ul><p>写 Cache 时, 可能出现<strong>写缺失</strong>问题: 对 Cache 进行写操作时, 要写的块不在 Cache, 这时有两种解决策略:</p><ol><li><strong>写分配</strong>: 写失效时, 将所写单元的块调入 Cache, 然后在进行写命中操作, 类似于读失效的操作.</li><li><strong>不按写分配</strong>: 写失效时, 直接将值写入下一级存储器, 而不重新调入需要的块到 Cache. 如此, 写的值不会在 Cache 中.</li></ol><p><strong>通常, 写回使用写分配, 写直达使用不按写分配</strong>. 因为写回策略中, 最新数据一定会有一份在 Cache 中, 而在写直达策略中, 最新数据一定会有一份在主存中, 使用对应的写缺失策略可以保证数据完整性.</p><h3 id="cache-性能" tabindex="-1"><a class="header-anchor" href="#cache-性能" aria-hidden="true">#</a> Cache 性能</h3><p>Cache 的性能通过两个参数定义:</p><p><strong>缺失率</strong>: Cache 访问中, 访问缺失次数占总访问次数的百分比.</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>R</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mi>M</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><mrow><mi>T</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> MissRate = \frac{MissTime}{TotalAccessTime} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ss</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">ccess</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ss</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><strong>缺失代价</strong>: Cache 访问缺失时, 访问下一级存储器所花费的时间, 通常用时钟周期数表示.</p><h4 id="存储器系统性能" tabindex="-1"><a class="header-anchor" href="#存储器系统性能" aria-hidden="true">#</a> 存储器系统性能</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>P</mi><mi>U</mi><mtext>执行时间</mtext><mo>=</mo><mo stretchy="false">(</mo><mi>C</mi><mi>P</mi><mi>U</mi><mtext>时钟周期数</mtext><mo>+</mo><mtext>存储器停顿周期数</mtext><mo stretchy="false">)</mo><mo>∗</mo><mtext>时钟周期时间</mtext><mspace linebreak="newline"></mspace><mtext>存储器停顿周期数</mtext><mo>=</mo><mtext>指令数</mtext><mo>∗</mo><mtext>每条指令访存次数</mtext><mo>∗</mo><mtext>缺失率</mtext><mo>∗</mo><mtext>缺失代价</mtext><mspace linebreak="newline"></mspace><mi>C</mi><mi>P</mi><mi>U</mi><mtext>时钟周期数</mtext><mo>=</mo><mi>C</mi><mi>P</mi><msub><mi>I</mi><mtext>执行</mtext></msub></mrow><annotation encoding="application/x-tex"> CPU 执行时间 = (CPU 时钟周期数 + 存储器停顿周期数) * 时钟周期时间 \\ 存储器停顿周期数 = 指令数 * 每条指令访存次数 * 缺失率 * 缺失代价 \\ CPU 时钟周期数 = CPI_{执行} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord cjk_fallback">执行时间</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord cjk_fallback">时钟周期数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">存储器停顿周期数</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">时钟周期时间</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">存储器停顿周期数</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">指令数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">每条指令访存次数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">缺失率</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">缺失代价</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord cjk_fallback">时钟周期数</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">执行</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>P</mi><msub><mi>I</mi><mtext>执行</mtext></msub></mrow><annotation encoding="application/x-tex">CPI_{执行}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CP</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">执行</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是没有考虑存储器停顿的理想 CPI, 包括 ALU 指令和存储器指令.</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>平均存储器访问时间</mtext><mo>=</mo><mfrac><mtext>总访存时间</mtext><mtext>存储器访问次数</mtext></mfrac><mspace linebreak="newline"></mspace><mtext>  </mtext><mspace linebreak="newline"></mspace><mo>=</mo><mfrac><mrow><mtext>总访问命中时间</mtext><mo>+</mo><mtext>总访问缺失时间</mtext></mrow><mtext>存储器总访问次数</mtext></mfrac><mspace linebreak="newline"></mspace><mtext>  </mtext><mspace linebreak="newline"></mspace><mo>=</mo><mfrac><mtext>总命中访问时间</mtext><mtext>存储器总访问次数</mtext></mfrac><mo>+</mo><mfrac><mrow><mtext>总缺失次数</mtext><mo>∗</mo><mtext>缺失代价</mtext></mrow><mtext>存储器总访问次数</mtext></mfrac><mspace linebreak="newline"></mspace><mtext>  </mtext><mspace linebreak="newline"></mspace><mo>=</mo><mtext>命中时</mtext><msub><mtext>间</mtext><mtext>一次访存</mtext></msub><mo>+</mo><mtext>缺失率</mtext><mo>∗</mo><mtext>缺失代价</mtext></mrow><annotation encoding="application/x-tex"> 平均存储器访问时间 = \frac{总访存时间}{存储器访问次数} \\ \; \\ = \frac{总访问命中时间 + 总访问缺失时间}{存储器总访问次数} \\ \; \\ = \frac{总命中访问时间}{存储器总访问次数} + \frac{总缺失次数 * 缺失代价}{存储器总访问次数} \\ \; \\ = 命中时间_{一次访存} + 缺失率 * 缺失代价 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">平均存储器访问时间</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">存储器访问次数</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">总访存时间</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">存储器总访问次数</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">总访问命中时间</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">总访问缺失时间</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">存储器总访问次数</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">总命中访问时间</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">存储器总访问次数</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">总缺失次数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">缺失代价</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord cjk_fallback">命中时</span><span class="mord"><span class="mord cjk_fallback">间</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">一次访存</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">缺失率</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">缺失代价</span></span></span></span></span></p><h3 id="cache-性能改善方法" tabindex="-1"><a class="header-anchor" href="#cache-性能改善方法" aria-hidden="true">#</a> Cache 性能改善方法</h3><ol><li>减少缺失率: <ol><li>增加块大小.</li><li>增大 Cache 容量.</li><li>更高相联度.</li><li>编译优化.</li></ol></li><li>减少缺失代价: <ol><li>多级 Cache.</li><li>关键字优化.</li><li>读缺失优于写缺失.</li><li>合并写缓冲.</li><li>牺牲缓冲.</li></ol></li><li>通过并行减少缺失代价和缺失率: <ol><li>非阻塞 Cache.</li><li>硬件预取.</li><li>编译预取.</li></ol></li><li>减少 Cache 的命中时间: <ol><li>小而简单的 Cache.</li><li>避免地址转换.</li><li>流水线 Cache 访问.</li><li>路预测.</li><li>踪迹 Cache.</li></ol></li></ol><h4 id="减少-cache-缺失率" tabindex="-1"><a class="header-anchor" href="#减少-cache-缺失率" aria-hidden="true">#</a> 减少 Cache 缺失率</h4><p>缺失分类:</p><ol><li>强制缺失: 第一次访问某个块, 一定不在 Cache 中, 也称作冷启动缺失或者首次访问缺失.</li><li>容量缺失: Cache 容纳不了一个执行程序的所有块, 一些块被替换出去之后, 又要被访问, 引起容量缺失.</li><li>冲突缺失: 对于组相联映像或者全相联映像, 如果太多的块被映射到一组, 一块被替换后可能又要访问, 引起冲突缺失. 也成为碰撞缺失或者干涉缺失.</li><li>一致性缺失: 由于一致性 Cache 引起的脏数据.</li></ol><p>解决方法:</p><ol><li>增大 Cache 容量: <ul><li>可以解决容量缺失和冲突缺失.</li><li>缺点是更长的命中时间和更高的价格.</li></ul></li><li>增大块容量: <ul><li>可以解决强制缺失.</li><li>可能增加缺失代价, 基本会增加冲突缺失, 在小容量 Cache 中, 可能增加容量缺失.</li></ul></li><li>更高的相联度: <ul><li>减少了冲突缺失.</li></ul></li><li>编译器优化: <ul><li>合并数组.</li><li>循环交换.</li><li>循环融合.</li><li>分块.</li></ul></li></ol><h4 id="减少-cache-缺失代价" tabindex="-1"><a class="header-anchor" href="#减少-cache-缺失代价" aria-hidden="true">#</a> 减少 Cache 缺失代价</h4><ol><li>使用多级 Cache: 一级 Cache 减少命中时间, 二级 Cache 减少缺失代价, 同时增大二级 Cache 的相联度.</li><li>关键字优先和提前重启动:</li><li>读缺失优先于写缺失: 可能会有读写冲突.</li><li>合并写缓冲: 合并写多个字代替写一个字, 改善写缓冲效率.</li><li>牺牲缓存: 用一组小的全相联 Cache 来存放最近被替换出的几个块.</li></ol><h4 id="通过并行减少" tabindex="-1"><a class="header-anchor" href="#通过并行减少" aria-hidden="true">#</a> 通过并行减少</h4><ol><li>非阻塞 Cache: 等待数据返回的同时, Cache 并不停止, 可以继续提供指令和数据.</li><li>硬件预取.</li><li>编译器控制预取.</li></ol><h4 id="减少-cache-命中时间" tabindex="-1"><a class="header-anchor" href="#减少-cache-命中时间" aria-hidden="true">#</a> 减少 Cache 命中时间</h4><ol><li>小而简单的 Cache</li><li>在 Cache 索引时, 避免地址转化: 使用 TLB; 或者 Cache 也使用虚拟地址.<br><img src="/assets/TLB-855ccf46.png" alt="TLB" loading="lazy"></li><li>流水线 Cache 访问.</li><li>路预测: 针对组相联, 在 Cache 中预留特殊的位, 预测下一次访问 Cache 可能在组中会用到的路或者块.</li><li>踪迹 Cache</li></ol><h3 id="主存储器性能优化" tabindex="-1"><a class="header-anchor" href="#主存储器性能优化" aria-hidden="true">#</a> 主存储器性能优化</h3><p>主存储器通常采用 DRAM, 主存的性能由<strong>延迟</strong>和<strong>带宽</strong>决定.</p><p>主存储器优化主要有两种方式:</p><ol><li>增加带宽.</li><li>交叉访问存储器.</li></ol><h4 id="增加带宽" tabindex="-1"><a class="header-anchor" href="#增加带宽" aria-hidden="true">#</a> 增加带宽</h4><p>使用 n 倍于 Cache 与主存之间的带宽, 主存带宽也将增加 n 倍.</p><p><img src="/assets/SingleBandwidthMemory-77332d52.png" alt="SingleBandwidthMemory" loading="lazy"><img src="/assets/MultiwordBandwidthMemory-91209e42.png" alt="MultiwordBandwidthMemory" loading="lazy"></p><p>此方法的缺点是:</p><ul><li>为了提供字访问, 关键路径需要多路开关.</li><li>增加用户购买的最小存储器容量.</li><li>复杂的纠错结构.</li></ul><p>单体多字存储器的性能:</p><p>定义<strong>带宽</strong>为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>带宽</mtext><mo>=</mo><mfrac><mrow><mi>C</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mtext>块容量</mtext></mrow><mtext>缺失代价</mtext></mfrac></mrow><annotation encoding="application/x-tex"> 带宽 = \frac{Cache 块容量}{缺失代价} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">带宽</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">缺失代价</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">块容量</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>增加 Cache 和主存之间的带宽到 n 倍, 缺失代价不变, 带宽变为:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>n</mi><mo>∗</mo><mi>C</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mtext>块容量</mtext></mrow><mtext>缺失代价</mtext></mfrac><mo>=</mo><mi>n</mi><mo>∗</mo><mtext>原带宽</mtext></mrow><annotation encoding="application/x-tex"> \frac{n * Cache 块容量}{缺失代价} = n * 原带宽 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">缺失代价</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">块容量</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">原带宽</span></span></span></span></span></p><h4 id="交叉访问存储器" tabindex="-1"><a class="header-anchor" href="#交叉访问存储器" aria-hidden="true">#</a> 交叉访问存储器</h4><p>利用存储系统中具有多个 DRAM 潜在的并行性, 这种主存组织对连续访问的写直达策略尤其重要.</p><p>存储器芯片按多个体组织以便同时读或者写多个字. 每个个体通常是 1 个字宽度, 因此总线与 Cache 宽度不需要改变. 但是, 要分时发送地址到多个体, 使得他们几乎都同时读数据.</p><figure><img src="/assets/MultibodyInterleavedMemory-fc578727.png" alt="MultibodyInterleavedMemory" tabindex="0" loading="lazy"><figcaption>MultibodyInterleavedMemory</figcaption></figure><figure><img src="/assets/InterleavedMemoryAccessPattern-b2f00535.png" alt="InterleavedMemoryAccessPattern" tabindex="0" loading="lazy"><figcaption>InterleavedMemoryAccessPattern</figcaption></figure><p>此方法对带宽的提升在于减少缺失代价.</p><h3 id="虚拟存储器" tabindex="-1"><a class="header-anchor" href="#虚拟存储器" aria-hidden="true">#</a> 虚拟存储器</h3><h4 id="页式虚拟存储器" tabindex="-1"><a class="header-anchor" href="#页式虚拟存储器" aria-hidden="true">#</a> 页式虚拟存储器</h4><p>Cache 中的块对应虚存中的页. 缺失即页失效, 需要有从虚存到主存的<strong>存储器映射</strong>.</p><p>虚存的映射策略采用全相联策略: 允许块放在主存的任意位置.</p><p>页式虚存依赖数据结构表, 包含了块的物理地址, 按照页号对块进行查找. 映射方式为: 在物理页地址后, 简单拼接偏移地址.</p><p>页表的大小即虚拟地址空间的页数.</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>T</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>=</mo><mfrac><msup><mn>2</mn><mrow><mi>B</mi><mi>i</mi><mi>t</mi><mi>s</mi><mi>O</mi><mi>f</mi><mi>V</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>u</mi><mi>a</mi><mi>l</mi><mi>A</mi><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msup><mrow><mi>P</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow></mfrac><mo>∗</mo><mi>P</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>I</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow><annotation encoding="application/x-tex"> PageTableSize = \frac{2^{BitsOfVirtualAddress}}{PageSize} * PageItemSize </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">ab</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4065em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5261em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">Vi</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight">dd</span><span class="mord mathnormal mtight">ress</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span></span></span></span></span></p><figure><img src="/assets/PageVirtualAddressTransition-b35054a7.png" alt="PageVirtualAddressTransition" tabindex="0" loading="lazy"><figcaption>PageVirtualAddressTransition</figcaption></figure><p>页表同样可以进行优化, 如:</p><ul><li>减小页表大小: 对虚拟地址应用一个散列函数, 允许页表长度仅为主存中的物理页的数目.</li><li>减少地址转换时间: 增加一个 Cache 进行虚-实地址转换, 即变换旁路缓冲器(Translation Look-aside Buffer, TLB).</li></ul><p>虚存中, 页的替换策略一般都使用 LRU, 通过为每一页提供一位使用位或参考位.</p><p>写策略使用写回方式, 因为写磁盘的速度太低, 写直达效率非常低. 同时, 设置 dirty-bit, 只有在块被更改后, 才会写回磁盘.</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Riicarus/edit/main/docs/posts/ComputerScience/ComputerArchitecture/ComputerArchitecture.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: riicarus.acc@gmail.com">Riicarus</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-1db72e39.js" defer></script>
  </body>
</html>
